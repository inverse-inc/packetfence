function init(){$("#section").on("submit",'form[name="section"]',function(a){var b=$(this),c=b.attr("action"),d=isFormValid(b),e=b.find(".btn-primary");return d&&(e.button("loading"),$.ajax({type:"POST",url:c,data:b.serialize()}).always(function(){e.button("reset"),$("body,html").animate({scrollTop:0},"fast"),resetAlert($("#section"))}).done(function(a){showSuccess(b,a.status_msg)}).fail(function(a){var c=getStatusMsg(a);showPermanentError(b,c)})),!1}),$("#section").on("section.loaded",function(a){$(":input:not(:disabled):not([readonly]):visible:enabled:first[name]").focus(),$(".compound-input-btn-group .btn-group input").each(function(a,b){var c=$(b).attr("value");$(b).siblings('a[value="'+c+'"]').attr("default-value","yes")}),$("#tabView").find('[data-toggle="tab"]').first().tab("show")}),$("#section").on("reset",function(a){return $('.compound-input-btn-group .btn-group a[default-value="yes"]').click(),!0}),$("#section").on("show",'[href="#newTabView"]',function(a){var b=$(a.target),c=b.attr("href"),d=$(c),e=b.attr("data-href");return d.load(e,function(){d.find(".switch").bootstrapSwitch()}),!0});var a=$(".sidenav-category a").first().attr("href");a=a?a.replace(/^.*#/,"/"):"/configuration",$(window).hashchange(pfOnHashChange(updateSection,a)),$(window).hashchange(),activateNavLink()}function initVariableList(a){$("#variable_list").on("click",".insert-into-file",function(b){var c=$(this),d=c.attr("data-content");return a.insert(d),a.focus(),!1})}function initShowLinesCheckBox(a){var b=$("#file-editor-show-lines"),c=a.renderer;b.off("click"),b.click(function(a){return c.setShowGutter(this.checked),!0}),c.setShowGutter(b.is(":checked"))}function initSaveModal(a,b){var c=$("#saveFile"),d=c.find("a.btn-primary").first();d.off("click"),d.click(function(d){var e=$("#file_editor_form");b.val(a.getValue()),submitFormHideModal(c,e)})}function initCancelModal(){$("#cancelEdit").find("a.btn-primary").first().click(function(a){window.location=$(this).attr("href")})}function initEditor(a,b){var c=$("#cancel-link"),d=$(".form-actions a.btn.editorToggle"),e=function(b){c.attr("data-toggle","modal"),d.toggleClass("disabled"),a.removeEventListener("change",e)};a.setTheme("ace/theme/monokai"),a.getSession().setMode("ace/mode/html"),a.on("change",e),a.focus(),$("#rename_file").on("submit",function(){return submitFormHideModalGoToLocation($("#renameModal"),$(this)),!1}),$("#resetContent").find("a.btn-primary").first().click(function(f){a.setValue(b.val(),-1),c.removeAttr("data-modal"),d.toggleClass("disabled"),a.on("change",e)})}function initRenameForm(a){var b=$("#file_name"),c=b.next().first(),d=b.find("a").first(),e=c.next().first(),f=c.children().first(),g=$("#rename_file");a.on("click","#file_name a",function(a){e.html(f.val()),f.width(e.width()+5),c.removeClass("hidden"),d.addClass("hidden"),f.focus()}),$("#new_file_name").keyup(function(a){var b=$(this);27==a.keyCode?b.focusout():(e.html(b.val()),b.width(e.width()+5))}),$("#new_file_name").focusout(function(a){e.html(f.val()),f.width(e.width()+5),c.addClass("hidden"),d.removeClass("hidden"),g[0].reset()})}function initEditorPage(a){var b=$("#file_content"),c=ace.edit("editor");initVariableList(c),initShowLinesCheckBox(c),initSaveModal(c,b),initCancelModal(),initEditor(c,b),initRenameForm(a)}function initCollapse(a){a.on("show hidden",".collapse",function(b){var c=$(this);c.closest("tr").first().swap_class("toggle"),a.find('[data-target="#'+c.attr("id")+'"]').find("[data-swap]").swap_class("toggle"),b.stopPropagation()})}function initCopyModal(a){var b=$("#copyModal"),c=b.find(".btn-primary").first();b.on("shown",function(){$(this).find(":input:first").focus()}),b.on("hidden",function(){$(this).data("modal").$element.removeData()}),c.off("click"),c.click(function(a){var c=b.find("#copyModalForm");submitFormHideModal(b,c)}),a.on("submit","#copyModalForm",function(){return submitFormHideModal(b,$(this)),!1})}function submitFormHideModalGoToLocation(a,b){$.ajax({async:!1,url:b.attr("action"),type:b.attr("method")||"POST",data:b.serialize()}).always(function(){a.modal("hide")}).done(function(a,b,c){location.hash=c.getResponseHeader("Location")}).fail(function(a){$("body,html").animate({scrollTop:0},"fast");var b=getStatusMsg(a);showError($("#section h2"),b)})}function initNewFileModal(a){var b=$("#newFileModal"),c=b.find(".btn-primary").first();b.on("hidden",function(){$(this).data("modal").$element.removeData()}),b.on("shown",function(){$(this).find(":input:first").focus()}),c.off("click"),c.click(function(a){var c=b.find("#newFileModalForm");return submitFormHideModalGoToLocation(b,c),!1}),a.on("submit","#newFileModalForm",function(){return submitFormHideModalGoToLocation(b,$(this)),!1})}function disabledLinks(a){a.on("click",".disabled",function(){return!1})}function initIndexPage(a){}function initCreatePage(a){var b=a.find("#create_profile"),c=b.find(".btn-primary").first();c.off("click"),c.click(function(a){var c=isFormValid(b);return c||$("body,html").animate({scrollTop:0},"fast"),c});var d=$("#createProfile"),e=d.find(".btn-primary").first();e.off("click"),e.click(function(a){return submitFormHideModalGoToLocation(d,b),!1}),initReadPage(a)}function initReadPage(a){updateDynamicRowsAfterRemove($("#locale")),updateDynamicRowsAfterRemove($("#filter")),$("#locale, #sources").on("admin.added","tr",function(a){var b=$(this),c=b.siblings(":not(.hidden)"),d=c.find("select option:selected"),e=b.find("select");e.find("option:selected").removeAttr("selected");var f=e.find('option[value!=""]');f.each(function(a,b){var c='[value="'+b.value+'"]';if(0===d.filter(c).length)return $(b).attr("selected","selected"),!1});var g=b.siblings(":not(.hidden)").addBack();g.length==f.length&&g.find('[href="#add"]').addClass("hidden")}),$("#sources").on("change","select",function(a){var b=$(this),c=b.closest("tr");"exclusive"==b.find(":selected").attr("data-source-class")?(c.siblings(":not(.hidden)").find('[href="#delete"]').click(),c.find('[href="#add"]').addClass("hidden")):c.find('[href="#add"]').removeClass("hidden")}),$("#filter").on("change",'select[name$=".type"]',function(a){updateFilterMatchInput($(a.currentTarget),!1)}),$('[id$="Empty"]').on("click",'[href="#add"]',function(a){var b=/(.+)Empty/.exec(a.delegateTarget.id),c=b[1],d=b[0];return $("#"+c).trigger("addrow"),$("#"+d).addClass("hidden"),!1}),$('select[name$=".type"]:not(:disabled)').each(function(a,b){updateFilterMatchInput($(b),!0)})}function updateFilterMatchInput(a,b){var c=a.next(),d=a.val(),e="#"+d+"_filter_match",f=$(e);0===f.length&&(f=$("#default_filter_match")),f.length&&(changeInputFromTemplate(c,f,b),"switch"==d&&a.next().typeahead({source:searchSwitchesGenerator($("#section h2")),minLength:2,items:11,matcher:function(a){return!0}}))}function initTemplatesPage(a){initCopyModal(a),initCollapse(a),initNewFileModal(a)}function connectionProfileGlobalInit(a){initWidgets(a.find(".chzn-select")),disabledLinks(a)}function Domains(){}function DomainView(a){ItemView.call(this,a);this.parent=a.parent,this.items=a.items;var b=this.items.id;a.parent.off("click",b+' [href$="/delete"]');var c=$.proxy(this.deleteItem,this);a.parent.on("click",b+' [href$="/delete"]',c);var d=$.proxy(this.updateAndJoinDomain,this);a.parent.on("click","#saveAndJoinDomain",d)}function Items(){}function ItemView(a){this.parent=a.parent;var b=a.items;this.items=b,this.disableToggle=!1;var c=b.id,d=b.formName,e=$.proxy(this.readItem,this);a.parent.on("click",c+' .item [href$="/read"]',e),a.parent.on("click",c+' [href$="/clone"]',e),a.parent.on("click",b.createSelector,e);var f=$.proxy(this.updateItem,this);a.parent.on("submit",'form[name="'+d+'"]',f);var g=$.proxy(this.deleteItem,this);a.parent.on("click",c+' [href$="/delete"]',g);var h=$.proxy(this.listItems,this);a.parent.on("click",c+' [href*="/list"]',h);var i=$.proxy(this.search,this);a.parent.on("submit",'form[name="search"]',i);var j=$.proxy(this.resetSearch,this);a.parent.on("reset",'form[name="search"]',j);var k=$.proxy(this.searchNext,this);a.parent.on("click",c+' [href*="/search"]',k)}function submitFormGoToLocation(a){$.ajax({async:!1,url:a.attr("action"),type:a.attr("method")||"POST",data:a.serialize()}).done(function(a,b,c){location.hash=c.getResponseHeader("Location")}).fail(function(a){$("body,html").animate({scrollTop:0},"fast");var b=getStatusMsg(a);showError($("#section h2"),b)})}function initActionMatchInput(){$('select[name$=".type"]:not(:disabled)').each(function(a,b){updateActionMatchInput($(b),!0)})}function updateActionMatchInput(a,b){var c=a.next(),d=a.val(),e="#"+d+"_action_match",f=$(e);0===f.length&&(f=$("#default_action_match")),f.length&&(changeInputFromTemplate(c,f,b),"switch"==d&&a.next().typeahead({source:searchSwitchesGenerator($("#section h2")),minLength:2,items:11,matcher:function(a){return!0}}))}$(function(){$("#section").on("click",'.sources [href*="/delete"]',function(a){if($(this).hasClass("disabled"))return!1;var b=$(this).attr("href"),c=$(this).closest("tr"),d=c.find('[href*="/read"]').first().text(),e=$("#deleteSource"),f=e.find("a.btn-primary").first();return e.find("h3 span").html(d),e.modal({show:!0}),f.off("click"),f.click(function(){return $.ajax(b).always(function(){e.modal("hide")}).done(function(a){$(window).hashchange()}).fail(function(a){$("body,html").animate({scrollTop:0},"fast");var b=getStatusMsg(a);showError($("#section h2"),b)}),!1}),!1}),$("#section").on("click","#testSource",function(a){a.preventDefault();var b=$(this),c=b.closest("form"),d=isFormValid(c);resetAlert($("#section")),d&&$.ajax({type:"POST",url:b.attr("href"),data:c.serialize()}).done(function(a){showSuccess(c,a.status_msg)}).fail(function(a){var b=getStatusMsg(a);showPermanentError(c,b)})}),$("#section").on("submit",'form[name="create_source"]',function(a){a.preventDefault();var b=$(this);isFormValid(b)&&(resetAlert($("#section")),$.ajax({type:"POST",url:b.attr("action"),data:b.serialize()}).done(function(a,b,c){location.hash=c.getResponseHeader("Location")}).fail(function(a){$("body,html").animate({scrollTop:0},"fast");var c=getStatusMsg(a);showPermanentError(b,c)}))}),$("#section").on("submit",'form[name="source"]',function(a){a.preventDefault();var b=$(this),c=b.find(".btn-primary");isFormValid(b)&&(c.button("loading"),resetAlert($("#section")),$.ajax({type:"POST",url:b.attr("action"),data:b.serialize()}).always(function(){c.button("reset")}).done(function(a,b,c){$("#section").fadeOut("fast",function(){$(this).empty(),$(this).html(a),$(this).fadeIn("fast",function(){$(".chzn-select").chosen(),$("#id").focus()})})}).fail(function(a){$("body,html").animate({scrollTop:0},"fast");var c=getStatusMsg(a);showPermanentError(b,c)}))}),$("#section").on("click","#sourceRules a:not(.btn-icon)",function(a){var b=$("#modalRule"),c=$(this).attr("href"),d=$("#section"),e=d.prev(".loader");return e.show(),d.fadeTo("fast",.5),b.empty(),$.ajax(c).always(function(){e.hide(),d.stop(),d.fadeTo("fast",1)}).done(function(a){b.append(a),b.one("shown",function(){$("#id").focus()}),b.modal({shown:!0});var c=$("#class"),d=$("#ruleActions"),e=d.children("tbody").children("tr");"administration"==c.find(":selected").attr("value")?(e.find('option[data-rule-class="administration"]').removeClass("hidden"),e.find('option[data-rule-class="authentication"]').addClass("hidden")):"authentication"==c.find(":selected").attr("value")&&(e.find('option[data-rule-class="authentication"]').removeClass("hidden"),e.find('option[data-rule-class="administration"]').addClass("hidden"))}).fail(function(a){$("body,html").animate({scrollTop:0},"fast");var b=getStatusMsg(a);showError($("#section h3"),b)}),!1}),$("#section").on("click","#createRule",function(a){var b=$("#modalRule"),c=$(this).attr("href"),d=$("#section"),e=d.prev(".loader");return e.show(),d.fadeTo("fast",.5),b.empty(),$.ajax(c).always(function(){e.hide(),d.stop(),d.fadeTo("fast",1)}).done(function(a){b.append(a),b.one("shown",function(){$("#id").focus(),$("#class").trigger("change")}),b.modal({shown:!0})}).fail(function(a){$("body,html").animate({scrollTop:0},"fast");var b=getStatusMsg(a);showError($("#section h3"),b)}),!1}),$("#section").on("submit",'form[name="rule"]',function(a){var b=$(this),c=b.find(".btn-primary"),d=$("#modalRule"),e=d.find(".modal-body").first();return isFormValid(b)&&(c.button("loading"),resetAlert(e),b.find("tr.hidden :input").attr("disabled","disabled"),$.ajax({type:"POST",url:b.attr("action"),data:b.serialize()}).always(function(){c.button("reset")}).done(function(a){d.one("hidden",function(){$("#sourceRulesEmpty").closest(".control-group").fadeOut("fast",function(){$(this).empty(),$(this).html(a),$(this).fadeIn("fast",function(){$(".chzn-select").chosen({width:""})})})}),d.modal("hide")}).fail(function(a){var c=getStatusMsg(a);showPermanentError(e.children().first(),c),b.find("tr.hidden :input").removeAttr("disabled")})),!1}),$("#section").on("change","#class",function(a){var b=$(this),c=$("#ruleActions");c.find("tr:not(.hidden)").remove();var d=c.children("tbody").children(".hidden").first();"administration"==b.find(":selected").attr("value")?(d.find('option[data-rule-class="administration"]').removeClass("hidden"),d.find('option[data-rule-class="administration"]').removeAttr("disabled"),d.find('option[data-rule-class="authentication"]').addClass("hidden"),d.find('option[data-rule-class="authentication"]').attr("disabled","disabled")):"authentication"==b.find(":selected").attr("value")&&(d.find('option[data-rule-class="authentication"]').removeClass("hidden"),d.find('option[data-rule-class="authentication"]').removeAttr("disabled"),d.find('option[data-rule-class="administration"]').addClass("hidden"),d.find('option[data-rule-class="administration"]').attr("disabled","disabled")),$("#ruleActions tr:not(.hidden) select[name$=type]").each(function(){updateAction($(this),!1)}),c.trigger("addrow"),c.find("tr").find('[href="#delete"]').addClass("hidden")}),$("body").on("click",'#ruleConditionsEmpty [href="#add"]',function(a){return $("#ruleConditions").trigger("addrow"),!1}),$("#section").on("show","#modalRule",function(a){"modalRule"==a.target.id&&($("#templates").find("option").removeAttr("id"),$("#ruleConditions tr:not(.hidden) select[name$=attribute]").each(function(){updateCondition($(this))}),$("#ruleActions tr:not(.hidden) select[name$=type]").each(function(){updateAction($(this),!0)}))}),$("#section").on("admin.added","#ruleConditions tr",function(a){var b=$(this).find("select[name$=attribute]").first();updateCondition(b)}),$("#section").on("change","#ruleConditions select[name$=attribute]",function(a){updateCondition($(this))}),$("#section").on("change","#ruleActions select[name$=type]",function(a){updateAction($(this))}),$("#section").on("admin.added","#ruleActions tr:not(.hidden)",function(a){var b=$(this).find("select[name$=type]").first();updateAction(b)})}),$("#section").on("section.loaded",function(a){for(var b=[{id:"#connection_profile_file_editor",initializer:initEditorPage},{id:"#connection_profile_files",initializer:initTemplatesPage},{id:"#connection_profile_index",initializer:initIndexPage},{id:"#connection_profile_create",initializer:initCreatePage},{id:"#connection_profile_read",initializer:initReadPage}],c=0;c<b.length;c++){var d=b[c],e=$(d.id);e.length&&(connectionProfileGlobalInit(e),d.initializer(e))}});var domainView;$(function(){var a=new Domains;domainView=new DomainView({items:a,parent:$("#section")})}),Domains.prototype=new Items,Domains.prototype.id="#domains",Domains.prototype.formName="modalDomain",Domains.prototype.modalId="#modalDomain",Domains.prototype.createSelector=".createDomain",DomainView.prototype=function(){function a(){}return a.prototype=ItemView.prototype,new a}(),DomainView.prototype.constructor=ItemView,DomainView.prototype.showWait=function(a){$("#modalDomainWait h3").html(a),$("#domainProgressBar").css("width","1%"),$("#modalDomainWait").modal("show")},DomainView.prototype.updateAndJoinDomain=function(a){a.preventDefault();var b=this,c=$(a.target),d=c.closest("form"),e=($(this.items.id),d.find(".btn")),f=d.closest(".modal");if(isFormValid(d)){var g=f.find(".modal-body").first();if(resetAlert(g),id_input=g.find("#id"),id_value=id_input.val(),!id_value.match(/^[a-zA-Z0-9]+$/))return void showError(g,"The id is invalid. The id can only contain alphanumeric characters.");d.find("tr.hidden :input").attr("disabled","disabled"),f.modal("hide"),b.showWait("The server is currently joining the domain"),this.items.post({url:c.attr("href"),data:d.serialize(),always:function(){d.find("tr.hidden :input").removeAttr("disabled"),e.button("reset"),$("#modalDomainWait").modal("hide")},success:function(a){var c=$("<div></div>");c.append("<h3>Result of the domain join</h3>"),c.append($("<pre>"+a.items.join_output+"</pre>")),b.showResultModal(c),b.list()},errorSibling:$("#section")})}},DomainView.prototype.showResultModal=function(a,b){$("#modalDomainInfo .modal-header h3").html(a),$("#modalDomainInfo .modal-body").html(b),$("#modalDomainInfo").modal("show")},DomainView.prototype.deleteItem=function(a){var b=this,c=a;if(a.preventDefault(),$(this).hasClass("disabled"))return!1;var d=$(this),e=(d.attr("href"),d.closest("tr")),f=e.find("td"),g=$(f[1]).text();g||(g=$(f[0]).text());var h=$("#deleteItem"),i=h.find("a.btn-primary").first();h.find("h3 span").html(g),h.modal("show"),i.off("click"),i.click(function(a){a.preventDefault(),i.button("loading"),a.preventDefault();var d=$(b.items.id),e=$(c.target),f=(e.closest("tr"),e.attr("href"));b.items.get({url:f,always:function(){i.button("reset"),h.modal("hide")},success:function(c){showSuccess(d,c.status_msg),b.list(a)},errorSibling:d})})},DomainView.prototype.list=function(){var a=$("#domains");this.listRefresh(a.attr("data-list-uri"))},DomainView.prototype.listRefresh=function(a){var b=$("#domains"),c=this;b.fadeTo("fast",.5,function(){c.items.get({url:a,always:function(){b.fadeTo("fast",1)},success:function(a){b.replaceWith(a)},errorSibling:$("#domains")})})},DomainView.prototype.setPassword=function(a,b){var c=$("#modalDomainSetPassword-"+a),d=$("#modalDomainSetPassword-"+a+" form");d.submit(function(a){return a.preventDefault(),$.ajax({url:d.attr("action"),type:"POST",data:d.serialize()}).done(function(a){c.modal("hide"),d.find('input[name="username"]').val(""),d.find('input[name="password"]').val(""),b()}).fail(function(a){$("body,html").animate({scrollTop:0},"fast");var b=getStatusMsg(a);d.find('input[name="username"]').val(""),d.find('input[name="password"]').val(""),showError($("#section h2"),b)}),!1}),c.modal("show")},$(document).ready(function(){$("#section").on("click",".rejoin_domain",function(a){var b=this;a.preventDefault();var c=$(a.target).parent().parent().children().children().html();return domainView.setPassword(c,function(){var a=domainView,c=$(b),d=c.html();c.attr("disabled","disabled"),c.html("Rejoining domain"),domainView.showWait("The server is rejoining the domain."),$.ajax({url:c.attr("href"),type:"GET"}).done(function(b){$("body,html").animate({scrollTop:0},"fast");var e=$("<div></div>");e.append("<h3>Result of the domain leave</h3>"),e.append($("<pre>"+b.items.leave_output+"</pre>")),e.append("<h3>Result of the domain join</h3>"),e.append($("<pre>"+b.items.join_output+"</pre>")),$("#modalDomainWait").modal("hide"),domainView.showResultModal(e),a.list(),c.html(d),c.removeAttr("disabled")}).fail(function(a){$("body,html").animate({scrollTop:0},"fast");var b=getStatusMsg(a);showError($("#section h2"),b),c.html(d),c.removeAttr("disabled")})}),!1}),$("#section").on("click","#refresh_domains",function(a){a.preventDefault();var b=$("#refresh_domains").html();$("#refresh_domains").attr("disabled","disabled"),$("#refresh_domains").html("Refreshing domains"),domainView.showWait("The server is refreshing the configuration."),$.ajax({url:$("#refresh_domains").attr("href"),type:"GET"}).done(function(a){$("body,html").animate({scrollTop:0},"fast"),$("#modalDomainWait").modal("hide"),showSuccess($("#section h2"),a.status_msg),$("#refresh_domains").html(b),$("#refresh_domains").removeAttr("disabled")}).fail(function(a){$("body,html").animate({scrollTop:0},"fast");var c=getStatusMsg(a);showError($("#section h2"),c),$("#refresh_domains").html(b),$("#refresh_domains").removeAttr("disabled")})}),setInterval(function(){var a=$("#domainProgressBar").width();if(a||0===a){a=100*a/$("#domainProgressBar").offsetParent().width(),100==a?a=0:(a+=10)>100&&(a=100),$("#domainProgressBar").css("width",a+"%")}},15e3)});var filtersView;$(function(){filtersView=new FiltersView({parent:$("#section")})});var FiltersView=function(a){this.parent=a.parent;var b=$.proxy(this.update,this);a.parent.on("submit","#filtersForm",b);var c=$.proxy(this.revert,this);a.parent.on("click","#filtersRevert",c);var d=$.proxy(this.setupEditor,this);a.parent.on("section.loaded",d)};FiltersView.prototype.setupEditor=function(){$("#editor").length&&(this.editor=ace.edit("editor"),this.editor.setTheme("ace/theme/monokai"),this.editor.getSession().setMode("ace/mode/perl"),this.disableButtons(),this.initialValue=this.editor.getValue())},FiltersView.prototype.revert=function(a){this.editor.setValue(this.initialValue,-1),this.disableButtons()},FiltersView.prototype.disableButtons=function(){$("#filtersForm .btn").addClass("disabled"),this.enableButtonsProxy=$.proxy(this.enableButtons,this),this.editor.on("change",this.enableButtonsProxy)},FiltersView.prototype.enableButtons=function(){$("#filtersForm .btn").removeClass("disabled"),this.editor.removeEventListener("change",this.enableButtonsProxy)},FiltersView.prototype.update=function(a){var b=this;a.preventDefault();var c=$(a.target);return $.ajax({url:c.attr("action"),type:"POST",data:{content:this.editor.getValue()}}).done(function(a){showSuccess(c,a.status_msg),b.initialValue=b.editor.getValue(),b.disableButtons()}).fail(function(a){var b=getStatusMsg(a);showPermanentError(c,b)}),!1},$(function(){var a=new FingerbankDevices;new FingerbankDeviceView({items:a,parent:$("#section")})});var FingerbankDevices=function(){};FingerbankDevices.prototype=new Items,FingerbankDevices.prototype.id="#fingerbankdevices",FingerbankDevices.prototype.formName="modalFingerbankDevice",FingerbankDevices.prototype.modalId="#modalFingerbankDevice",FingerbankDevices.prototype.createSelector=".createFingerbankDevice";var FingerbankDeviceView=function(a){ItemView.call(this,a);var b=$.proxy(this.showChildren,this);a.parent.on("click",'#fingerbankdevices [href$="/children"]',b);var c=$.proxy(this.readItem,this);a.parent.on("click",'#fingerbankdevices [href$="/add_child"]',c),a.parent.on("show hidden",".collapse",function(a){$(this).closest("tr").first().toggleClass("hidden"),a.stopPropagation()})};FingerbankDeviceView.prototype=function(){function a(){}return a.prototype=ItemView.prototype,new a}(),FingerbankDeviceView.prototype.constructor=FingerbankDeviceView,FingerbankDeviceView.prototype.showChildren=function(a){var b=this,c=$(a.currentTarget),d=c.attr("href"),e=c.attr("data-target"),f=$(e),g=f.closest("tr");return f.collapse({toggle:!1}),g.hasClass("hidden")?this.items.get({url:d,success:function(a){f.find("table").html(a),f.collapse("show")},errorSibling:$(b.id)}):f.collapse("hide"),!1},$(function(){$("#section").on("submit","#fingerbankonboard",function(a){return updateSectionFromForm($("#fingerbankonboard")),!1})}),$(function(){var a=new FloatingDevices;new FloatingDeviceView({items:a,parent:$("#section")})});var FloatingDevices=function(){};FloatingDevices.prototype=new Items,FloatingDevices.prototype.id="#floatingdevices",FloatingDevices.prototype.formName="modalFloatingDevice",FloatingDevices.prototype.modalId="#modalFloatingDevice",FloatingDevices.prototype.createSelector=".createFloatingDevice";var FloatingDeviceView=function(a){ItemView.call(this,a);var b=this;this.parent=a.parent,this.items=a.items,a.parent.on("change",'form[name="modalFloatingDevice"] input[name="trunkPort"]',this.toggleTaggedVlan),a.parent.on("show","#modalFloatingDevice",function(a){var c=$('form[name="modalFloatingDevice"] input[name="trunkPort"]').first();$.proxy(b.toggleTaggedVlan,c)(a)})};FloatingDeviceView.prototype=function(){function a(){}return a.prototype=ItemView.prototype,new a}(),FloatingDeviceView.prototype.constructor=FloatingDeviceView,FloatingDeviceView.prototype.toggleTaggedVlan=function(a){var b=$(this),c=b.closest("form").find('input[name="taggedVlan"]').first();b.is(":checked")?c.removeAttr("disabled"):c.attr("disabled",1)},$(function(){var a=new Interfaces,b=new InterfaceView({interfaces:a,parent:$("#section")}),c=$.proxy(b.readInterface,b);$("#section").on("click","#createNetwork",c)}),$(function(){var a=new Items;new ItemView({items:a,parent:$("#section")})}),Items.prototype.id="#items",Items.prototype.formName="modalItem",Items.prototype.modalId="#modalItem",Items.prototype.createSelector=".createItem",Items.prototype.get=function(a){$.ajax({url:a.url}).always(a.always).done(a.success).fail(function(b){var c=getStatusMsg(b);showPermanentError(a.errorSibling,c)})},Items.prototype.post=function(a){$.ajax({url:a.url,type:"POST",data:a.data}).always(a.always).done(a.success).fail(function(b){var c=getStatusMsg(b);showPermanentError(a.errorSibling,c)})},ItemView.prototype.readItem=function(a){a.preventDefault();var b=$(this.items.modalId),c=$("#section"),d=a.target;"A"!=d.nodeName&&(d=d.parentNode),c.loader(),c.fadeTo("fast",.5),b.empty(),$(".chosen-drop").remove(),this.items.get({url:$(d).attr("href"),always:function(){c.stop(),c.fadeTo("fast",1,function(){c.loader("hide")})},success:function(a){b.append(a),b.find(".chzn-select").chosen({width:""}),b.find(".chzn-deselect").chosen({allow_single_deselect:!0,width:""}),fixChosenClipping(b.find(".chzn-select, .chzn-deselect")),b.one("shown",function(){b.find(":input:visible").first().focus()}),b.modal({shown:!0})},errorSibling:c.find("h2").first()})},ItemView.prototype.updateItem=function(a){a.preventDefault();var b=this,c=$(a.target),d=$(this.items.id),e=c.find(".btn-primary"),f=c.closest(".modal");if(isFormValid(c)){var g=f.find(".modal-body").first();resetAlert(g),e.button("loading"),c.find("tr.hidden :input").attr("disabled","disabled"),this.items.post({url:c.attr("action"),data:c.serialize(),always:function(){c.find("tr.hidden :input").removeAttr("disabled"),e.button("reset")},success:function(a){f.modal("toggle"),showSuccess(d,a.status_msg),b.list()},errorSibling:g.children().first()})}},ItemView.prototype.list=function(){var a=$(this.items.id);this.items.get({url:a.attr("data-list-uri"),success:function(b){a.html(b)},errorSibling:a})},ItemView.prototype.deleteItem=function(a){a.preventDefault();var b=$(this.items.id),c=$(a.target),d=this,e=(c.closest("tr"),c.attr("href"));return this.items.get({url:e,success:function(c){showSuccess(b,c.status_msg),d.list(a)},errorSibling:b}),!1},ItemView.prototype.list=function(){var a=$(this.items.id);this.listRefresh(a.attr("data-list-uri"))},ItemView.prototype.listItems=function(a){a.preventDefault();var b=$(a.target);this.listRefresh(b.attr("href"))},ItemView.prototype.listRefresh=function(a){var b=$(this.items.id),c=this;b.fadeTo("fast",.5,function(){c.items.get({url:a,always:function(){b.fadeTo("fast",1)},success:function(a){b.replaceWith(a)},errorSibling:b})})},ItemView.prototype.resetSearch=function(a){return a.preventDefault(),this.list(),!1},ItemView.prototype.search=function(a){a.preventDefault();var b=$(a.target),c=b.attr("action");return this.searchRefresh(c,b),!1},ItemView.prototype.searchNext=function(a){a.preventDefault();var b=$("#search"),c=$(a.target),d=c.attr("href");return this.searchRefresh(d,b),!1},ItemView.prototype.searchRefresh=function(a,b){var c=$(this.items.id),d=this;return c.fadeTo("fast",.5,function(){d.items.post({url:a,data:b.serialize(),always:function(){c.fadeTo("fast",1)},success:function(a){c.replaceWith(a)},errorSibling:c})}),!1},$(function(){var a=new Pfdetects;new PfdetectView({items:a,parent:$("#section")})});var Pfdetects=function(){};Pfdetects.prototype=new Items,Pfdetects.prototype.id="#pfdetects",Pfdetects.prototype.formName="modalPfdetect",Pfdetects.prototype.modalId="#modalPfdetect",Pfdetects.prototype.createSelector=".createPfdetect";var PfdetectView=function(a){ItemView.call(this,a);this.parent=a.parent;var b=a.items;this.items=b;var c=b.id;b.formName;a.parent.off("click",c+' [href$="/clone"]');var d=$.proxy(this.showTestRegex,this);a.parent.on("show","#test-regex",d);var e=$.proxy(this.toggleResults,this);a.parent.on("shown","#test-regex-results .collapse",e),a.parent.on("hidden","#test-regex-results .collapse",e);var f=$.proxy(this.testRegex,this);a.parent.on("click","#test-regex-btn",f);var g=this.handleChangeApiMethod;a.parent.on("change",'form[name="modalPfdetect"] [name$=".api_method"]',g)};PfdetectView.prototype=function(){function a(){}return a.prototype=ItemView.prototype,new a}(),PfdetectView.prototype.constructor=PfdetectView,PfdetectView.prototype.updateItem=function(a){a.preventDefault();var b=$(a.target),c=($(this.items.id),$("#section"),b.find(".btn-primary"));if(isFormValid(b)){var d=b.find("h2").first();c.button("loading"),this.items.post({url:b.attr("action"),data:b.serialize(),always:function(){c.button("reset")},success:function(a,b,c){var e=c.getResponseHeader("Location");showSuccess(d,a.status_msg),e&&(location.hash=e)},errorSibling:d})}},PfdetectView.prototype.toggleResults=function(a){var b=$(a.currentTarget),c=$('a[data-target="#'+b.attr("id")+'"] i');c.length&&c.toggleClass("icon-minus-circle",1)},PfdetectView.prototype.testRegex=function(a){a.preventDefault();var b=$(a.target),c=$(b.closest("form").first());if(isFormValid(c)){var d=b.attr("data-test-action"),e=$("#section");b.button("loading"),this.items.post({url:d,data:c.serialize(),always:function(){b.button("reset")},success:function(a){showSuccess(e.find("h2").first(),"Passed"),$("#test-regex-results").html(a)},errorSibling:e.find("h2").first()})}return!1},PfdetectView.prototype.showTestRegex=function(a){$('textarea[name="loglines"]').removeAttr("disabled")},PfdetectView.prototype.handleChangeApiMethod=function(a){var b=$(a.currentTarget),c=b.next(),d=b.val(),e="#"+d+"_api_parameters",f=$(e);0===f.length&&(f=$("#default_api_parameters")),f.length&&changeInputFromTemplate(c,f)},$("#section").on("click",'[id$="Empty"]',function(a){a.preventDefault();var b=/(.+)Empty/.exec($(a.target).closest(".unwell").attr("id")),c=b[1],d=b[0];return $("#"+c).trigger("addrow"),$("#"+d).addClass("hidden"),!1}),$("#section").on("submit",'form[name="formItem"]',function(a){a.preventDefault();var b=$(this),c=b.find(".btn-primary"),d=isFormValid(b);$('select[name$=".type"]:not(:disabled)').each(function(a,c){"Select an option"==$(c).val()&&(d=!1,showPermanentError(b,"Please select a valid action."))}),d&&(c.button("loading"),resetAlert($("#section")),$.ajax({type:"POST",url:b.attr("action"),data:b.serialize()}).always(function(){c.button("reset")}).done(function(a,c,d){showSuccess(b,"Saved"),window.location.hash="#config/portal_module/"+b.find('input[name="id"]').val()+"/read"}).fail(function(a){$("body,html").animate({scrollTop:0},"fast");var c=getStatusMsg(a);showPermanentError(b,c)}))}),$("#section").on("click",".delete-portal-module",function(a){a.preventDefault();var b=$(a.target);return b.button("loading"),$.ajax({type:"GET",url:b.attr("href")}).always(function(){}).done(function(a,c,d){showSuccess(b.closest(".table"),"Deleted"),b.closest("tr").remove()}).fail(function(a){b.button("reset"),$("body,html").animate({scrollTop:0},"fast");var c=getStatusMsg(a);showPermanentError(b.closest(".table"),c)}),!1}),$("#section").on("click",".expand",function(a){return a.preventDefault(),$(a.target).hide(function(){$($(a.target).attr("data-expand")).slideDown()}),!1}),$("#section").on("change",'#actions select[name$=".type"]',function(a){updateActionMatchInput($(a.currentTarget),!1)}),$("#section").on("click",'#actionsContainer a[href="#add"]',function(a){setTimeout(initActionMatchInput,3e3)}),$("#section").on("section.loaded",function(a){
var b=document.getElementById("modulesTreeData");if(b){var c=JSON.parse(b.textContent||b.innerHTML);$("#modulesTree").tree({data:c}),$("#modulesTree").bind("tree.click",function(a){var b=a.node;window.location.hash="#config/portal_module/"+b.id+"/read"})}initActionMatchInput()}),$(function(){var a=new Provisioners;new ProvisionerView({items:a,parent:$("#section")})});var Provisioners=function(){};Provisioners.prototype=new Items,Provisioners.prototype.id="#provisioners",Provisioners.prototype.formName="modalProvisioner",Provisioners.prototype.modalId="#modalProvisioner",Provisioners.prototype.createSelector=".createProvisioner";var ProvisionerView=function(a){ItemView.call(this,a);this.parent=a.parent,this.items=a.items;var b=$.proxy(this.toggleInputs,this);a.parent.on("change",'form[name="modalProvisioner"] select[name="security_type"]',b),a.parent.on("change",'form[name="modalProvisioner"] select[name="eap_type"]',b),a.parent.on("change",'form[name="modalProvisioner"] input[name="dpsk"]',b),a.parent.on("show","#modalProvisioner",b)};ProvisionerView.prototype=function(){function a(){}return a.prototype=ItemView.prototype,new a}(),ProvisionerView.prototype.constructor=ProvisionerView,ProvisionerView.prototype.toggleInputs=function(a){this.togglePkiProvider(a),this.toggleWifiKey(a),this.toggleEapType(a),this.toggleServerCertificate(a)},ProvisionerView.prototype.toggleWifiKey=function(a){var b=$("#security_type option:selected").text(),c=$("#eap_type option:selected").text(),d=$("#passcode").closest(".control-group"),e=$("#dpsk").closest(".control-group"),f=$('input[name="dpsk"]').prop("checked"),g=$("#psk_size").closest(".control-group");"Open"!=b&&"No EAP"==c?(e.show(),f?(g.show(),d.hide()):(g.hide(),d.show())):(d.hide(),e.hide())},ProvisionerView.prototype.toggleEapType=function(a){var b=$("#security_type option:selected").text(),c=$("#eap_type").closest(".control-group");"WPA2"==b?c.show():c.hide()},ProvisionerView.prototype.togglePkiProvider=function(a){var b=$("#security_type option:selected").text(),c=$("#eap_type option:selected").text(),d=$("#pki_provider").closest(".control-group");"WPA2"==b&&"EAP-TLS"==c?d.show():d.hide()},ProvisionerView.prototype.toggleServerCertificate=function(a){var b=$("#security_type option:selected").text(),c=$("#eap_type option:selected").text(),d=$("#server_certificate_path").closest(".control-group");"WPA2"==b&&"PEAP"==c?d.show():d.hide()},$("#section").on("click",'[href*="#modalRole"]',function(a){var b=$("#modalRole"),c=$(this).attr("href"),d=$("#section"),e=d.prev(".loader");return e.show(),d.fadeTo("fast",.5),b.empty(),$.ajax(c).always(function(){e.hide(),d.stop(),d.fadeTo("fast",1)}).done(function(a){b.append(a),b.one("shown",function(){$("#name").focus()}),b.modal({shown:!0})}).fail(function(a){$("body,html").animate({scrollTop:0},"fast");var b=getStatusMsg(a);showError($("#section table"),b)}),!1}),$("#section").on("click","#createRole",function(a){var b=$("#modalRole"),c=$(this).attr("href"),d=$("#section"),e=d.prev(".loader");return e.show(),d.fadeTo("fast",.5),b.empty(),$.ajax(c).always(function(){e.hide(),d.stop(),d.fadeTo("fast",1)}).done(function(a){b.append(a),b.one("shown",function(){$("#name").focus(),$(".chzn-select").chosen({width:""}),$(".chzn-deselect").chosen({allow_single_deselect:!0,width:""})}),b.modal({shown:!0})}).fail(function(a){$("body,html").animate({scrollTop:0},"fast");var b=getStatusMsg(a);showError($("#section table"),b)}),!1}),$("body").on("submit",'form[name="role"]',function(a){var b=$(this),c=$("#modalRole"),d=c.find(".modal-body");return isFormValid(b)&&(resetAlert(d),$.ajax({type:"POST",url:b.attr("action"),data:b.serialize()}).done(function(){c.on("hidden",function(){$(window).hashchange()}),c.modal("hide")}).fail(function(a){var b=getStatusMsg(a);resetAlert(d),showPermanentError(d.children().first(),b)})),!1}),$(function(){var a=new ScanWMIRules;new ScanWMIRuleView({items:a,parent:$("#section")})});var ScanWMIRules=function(){};ScanWMIRules.prototype=new Items;var ScanWMIRuleView=function(a){this.parent=a.parent,this.items=a.items,a.parent.on("click",'#wmi_rulesEmpty [href="#add"]',function(a){return $("#wmi_rules").trigger("addrow"),$("#wmi_rulesEmpty").addClass("hidden"),!1})};$(function(){var a=new Sources;new SourceView({items:a,parent:$("#section")})});var Sources=function(){};Sources.prototype=new Items,Sources.prototype.id="#sources",Sources.prototype.formName="modalSource",Sources.prototype.modalId="#modalSource";var SourceView=function(a){ItemView.call(this,a);var b=a.items,c=b.id,d=b.formName,e='form[name="'+d+'"]';a.parent.off("click",c+' [href$="/clone"]'),a.parent.off("click",c+' [href$="/delete"]'),a.parent.on("click","#testSourceBtn",$.proxy(this.testSource,this)),a.parent.on("change",e+' select[name*="\\.conditions\\."][name$=".attribute"]',$.proxy(this.changeCondition,this)),a.parent.on("change",e+' select[name*="\\.actions\\."][name$=".type"]',$.proxy(this.changeAction,this)),a.parent.on("section.loaded",$.proxy(this.loadSource,this)),a.parent.on("dynamic-list.add",'div[id^="accordion\\.group\\.administration_rules\\."]',$.proxy(this.addRule,this)),a.parent.on("dynamic-list.add",'div[id^="accordion\\.group\\.authentication_rules\\."]',$.proxy(this.addRule,this)),a.parent.on("dynamic-list.add",'div[id*="\\.actions\\."]',$.proxy(this.addAction,this)),a.parent.on("dynamic-list.add",'div[id*="\\.conditions\\."]',$.proxy(this.addCondition,this)),a.parent.on("dynamic-list.ordered",c+" #internal-sources tbody",$.proxy(this.sortItems,this))};SourceView.prototype=function(){function a(){}return a.prototype=ItemView.prototype,new a}(),SourceView.prototype.addCondition=function(a){a.stopPropagation();var b=$(a.target);return updateSoureRuleCondition(b.find('select[name*="\\.conditions\\."][name$=".attribute"]'),!0),!1},SourceView.prototype.addAction=function(a){a.stopPropagation();var b=$(a.target);return updateAction(b.find('select[name*="\\.actions\\."][name$=".type"]'),!0),!1},SourceView.prototype.addRule=function(a){$(a.target).find('select[name*="\\.actions\\."][name$=".type"]:not(.disabled)').each(function(){updateAction($(this),!0)})},SourceView.prototype.loadSource=function(a){var b=this.items.formName;$("#action_templates").find("option").removeAttr("id"),$('form[name="'+b+'"] select[name*="\\.conditions\\."][name$=".attribute"]:not(.disabled)').each(function(){updateSoureRuleCondition($(this),!0)}),$('form[name="'+b+'"] select[name*="\\.actions\\."][name$=".type"]:not(.disabled)').each(function(){updateAction($(this),!0)})},SourceView.prototype.changeAction=function(a){updateAction($(a.target),!1)},SourceView.prototype.changeCondition=function(a){updateSoureRuleCondition($(a.target),!1)},SourceView.prototype.testSource=function(a){a.preventDefault(),resetAlert($("#section"));var b=$(a.target),c=b.closest("form"),d=isFormValid(c),e=b.closest(".input-append");d?this.items.post({url:b.attr("href"),data:c.serialize(),always:function(){b.button("reset")},success:function(a,b,c){showSuccess(e,a.status_msg)},errorSibling:b.closest(e)}):showError(e,"Required field missing")},SourceView.prototype.sortItems=function(a){var b=$(a.target).closest("form");this.items.post({url:b.attr("action"),data:b.serialize(),success:function(a,c,d){showSuccess(b,a.status_msg)},errorSibling:b})},SourceView.prototype.updateItem=function(a){a.preventDefault();var b=$(a.target),c=b.find(".btn-primary");isFormValid(b)&&(c.button("loading"),resetAlert($("#section")),this.items.post({url:b.attr("action"),data:b.serialize(),always:function(){$("body,html").animate({scrollTop:0},"fast"),c.button("reset")},success:function(a,c,d){d.getResponseHeader("Location")?location.hash=d.getResponseHeader("Location"):showSuccess(b,a.status_msg)},errorSibling:b}))},SourceView.prototype.constructor=SourceView,$(function(){var a=new Switches;new SwitchView({switches:a,parent:$("#section")})});var Switches=function(){};Switches.prototype.get=function(a){$.ajax({url:a.url}).always(a.always).done(a.success).fail(function(b){var c=getStatusMsg(b);showPermanentError(a.errorSibling,c)})},Switches.prototype.post=function(a){$.ajax({url:a.url,type:"POST",data:a.data}).always(a.always).done(a.success).fail(function(b){var c=getStatusMsg(b);showPermanentError(a.errorSibling,c)})};var SwitchView=function(a){var b=this;this.parent=a.parent,this.switches=a.switches,this.disableToggle=!1;var c=$.proxy(this.readSwitch,this);a.parent.on("click",'#switches [href$="/read"], #switches [href$="/clone"], .createSwitch',c);var d=$.proxy(this.importSwitch,this);a.parent.on("submit",'form[name="modalSwitchImport"]',d);var e=$.proxy(this.updateSwitch,this);a.parent.on("submit",'form[name="modalSwitch"]',e);var f=$.proxy(this.deleteConfirm,this);a.parent.on("click",'#switches [href$="/delete"]',f);var g=$.proxy(this.removeGroup,this);a.parent.on("click",'form[name="modalSwitch"] [href$="/remove_group"]',g);var h=$.proxy(this.addToGroup,this);a.parent.on("click",'form[name="modalSwitch"] #addNewMember',h),a.parent.on("change",'form[name="modalSwitch"] input[name="uplink_dynamic"]',this.changeDynamicUplinks),a.parent.on("change",'form[name="modalSwitch"] input[type="checkbox"][name*="Map"]',this.changeRoleMapping),a.parent.on("click",'#inlineTriggerEmpty [href="#add"]',this.addInlineTrigger),a.parent.on("show","#modalSwitch",function(c){$("#inlineTrigger tr:not(.hidden) select").each(function(){b.updateInlineTrigger($(this))}),a.parent.find('#newMember[data-provide="typeahead"]').typeahead({source:$.proxy(b.searchSwitch,b),minLength:2,items:11,matcher:function(a){return!0}})}),a.parent.on("admin.added","#inlineTrigger tr",function(a){var c=$(this).find("select").first();b.updateInlineTrigger(c)}),a.parent.on("change","#inlineTrigger select",function(a){b.updateInlineTrigger($(this))});var i=$.proxy(this.pagination,this);a.parent.on("click",'#switches [href*="/list"]',i),a.parent.on("submit","#switches #search",$.proxy(this.submitSearch,this)),a.parent.on("reset","#switches #search",$.proxy(this.resetSearch,this)),a.parent.on("click",'#switches [href*="/switch/search"]',$.proxy(this.searchPagination,this)),a.parent.on("click","#invalidate_cache",$.proxy(this.invalidateCache,this))};SwitchView.prototype.readSwitch=function(a){a.preventDefault();var b=this,c=$("#modalSwitch"),d=$("#section"),e=d.prev(".loader");e.show(),d.fadeTo("fast",.5),c.empty(),$(".chzn-drop").remove(),this.switches.get({url:$(a.target).attr("href"),always:function(){e.hide(),d.stop(),d.fadeTo("fast",1)},success:function(a){c.append(a),c.find(".chzn-select").chosen({width:""}),c.find(".chzn-deselect").chosen({allow_single_deselect:!0,width:""}),c.one("shown",function(){var a;c.find(":input:visible").first().focus(),a=$('form[name="modalSwitch"] input[name="uplink_dynamic"]'),b.changeDynamicUplinks.call(a),a=$('form[name="modalSwitch"] input[type="checkbox"][name*="Map"]'),a.each(function(a){b.changeRoleMapping.call(this)})}),c.modal({shown:!0})},errorSibling:d.find("h2").first()})},SwitchView.prototype.changeRoleMapping=function(a){var b=$(this),c=/(.+)Map/.exec(b.attr("name")),d=c[1],e=$.merge(b.closest("form").find('input[type="text"][name*="'+d+'"]'),b.closest("form").find('textarea[name*="'+d+'"]'));b.is(":checked")?e.removeAttr("disabled"):e.attr("disabled",1)},SwitchView.prototype.changeDynamicUplinks=function(a){var b=$(this),c=b.closest("form").find('input[name="uplink"]').first();b.is(":checked")?c.attr("disabled",1):c.removeAttr("disabled")},SwitchView.prototype.addInlineTrigger=function(a){var b=$("#inlineTrigger").children("tbody"),c=b.children(".hidden").first();if(c){$("#inlineTriggerEmpty").addClass("hidden");var d=c.clone();d.removeClass("hidden"),d.insertBefore(c),d.trigger("admin.added")}return!1},SwitchView.prototype.updateInlineTrigger=function(a){var b=a.find(":selected").val(),c=a.next();if(b!=c.attr("data-trigger")){c.attr("disabled",1);var d=$("#"+b+"_trigger").clone();d.attr("id",c.attr("id")),d.attr("name",c.attr("name")),d.insertBefore(c),c.attr("data-trigger")||d.val(c.val()),c.remove(),d.attr("data-trigger",b)}},SwitchView.prototype.updateSwitch=function(a){a.preventDefault();var b=this,c=$(a.target),d=c.find(".btn-primary"),e=c.closest(".modal");if(isFormValid(c)){var f=e.find(".modal-body").first();resetAlert(f),d.button("loading"),c.find("tr.hidden :input").attr("disabled","disabled"),this.switches.post({url:c.attr("action"),data:c.serialize(),always:function(){c.find("tr.hidden :input").removeAttr("disabled"),d.button("reset")},success:function(a){e.modal("toggle"),showSuccess(b.parent.find(".table.items").first(),a.status_msg),b.refreshTable()},errorSibling:f.children().first()})}},SwitchView.prototype.importSwitch=function(a){var b=$(a.target),c=$("#iframe_form"),d=b.find(".btn-primary"),e=b.closest(".modal");d.button("loading"),c.one("load",function(a){d.button("reset");var b=$(this).contents().find("body"),c=b.find("textarea").val();e.modal("hide"),showPermanentSuccess($("#switches"),c)})},SwitchView.prototype.addToGroup=function(a){a.preventDefault();var b=this,c=$(a.target),d=$("#newMember").val();this.switches.get({url:"/config/switch/"+d+"/add_to_group/"+c.attr("data-group"),success:function(a){b.readSwitch({preventDefault:function(){},target:{href:"/config/switchgroup/"+c.attr("data-group")+"/read?tab=switchGroupMembers"}}),showSuccess($("#modalSwitch .modal-body").children().first(),a.status_msg)},errorSibling:$("#modalSwitch .modal-body").children().first()})},SwitchView.prototype.removeGroup=function(a){a.preventDefault();var b=$(a.target);this.switches.get({url:b.attr("href"),success:function(a){b.closest(".switchGroupMember").remove(),0===$(".switchGroupMember").size()&&$("#switchMembersEmpty").closest("tr").removeClass("hidden"),showSuccess($("#modalSwitch .modal-body").children().first(),a.status_msg)},errorSibling:$("#modalSwitch .modal-body").children().first()})},SwitchView.prototype.list=function(){this.switches.get({url:"/config/switch/list",success:function(a){$("#switches").html(a)},errorSibling:$("#switches")})},SwitchView.prototype.refreshPage=function(){var a=this,b=$(".pagination").first(),c=b.attr("data-from-form")||"#search",d=$(c),e=b.find("li.disabled a[href]").first();0===d.length&&(d=$("#search"));var f=$("#columns"),g=e.attr("href"),h=$("#section"),i=$("#section").find("h2").first(),j=h.prev(".loader");return j.show(),h.fadeTo("fast",.5),h.fadeTo("fast",.5,function(){a.switches.post({url:g,data:d.serialize()+"&"+f.serialize(),always:function(){j.hide(),h.fadeTo("fast",1)},success:function(a){h.html(a)},errorSibling:i})}),!1},SwitchView.prototype.refreshTable=function(){var a=this,b=$(".pagination").first(),c=b.attr("data-from-form")||"#search",d=$(c),e=b.find("li.disabled a[href]").first();0===d.length&&(d=$("#search"));var f=$("#columns"),g=e.attr("href"),h=$("#section"),i=$("#section").find("h2").first(),j=$("#switches"),k=h.prev(".loader");return k.show(),h.fadeTo("fast",.5,function(){a.switches.post({url:g,data:d.serialize()+"&"+f.serialize(),always:function(){k.hide(),h.fadeTo("fast",1)},success:function(a){j.html(a)},errorSibling:i})}),!1},SwitchView.prototype.pagination=function(a){a.preventDefault();var b=$(a.target),c=b.attr("href"),d=$("#section"),e=d.prev(".loader");return e.show(),d.fadeTo("fast",.5),this.switches.get({url:c,always:function(){e.hide(),d.stop(),d.fadeTo("fast",1)},success:function(a){$("#switches").html(a)},errorSibling:$("#switches")}),!1},SwitchView.prototype.searchPagination=function(a){a.preventDefault();var b=$(a.currentTarget),c=$("#search"),d=b.attr("href");return this.refreshListFromForm(d,c),!1},SwitchView.prototype.refreshListFromForm=function(a,b){var c=this,d=$("#section");$("body,html").animate({scrollTop:0},"fast");var e=$("#section").find("h2").first(),f=d.prev(".loader");return f.show(),d.fadeTo("fast",.5,function(){c.switches.post({url:a,data:b.serialize(),always:function(){f.hide(),d.fadeTo("fast",1)},success:function(a){$("#switches").html(a)},errorSibling:e})}),!1},SwitchView.prototype.submitSearch=function(a){a.preventDefault();var b=$(a.currentTarget),c=b.attr("action");return this.refreshListFromForm(c,b),!1},SwitchView.prototype.resetSearch=function(a){var b=this,c=$("#section");$("body,html").animate({scrollTop:0},"fast");var d=$("#section").find("h2").first(),e=c.prev(".loader");return e.show(),c.fadeTo("fast",.5,function(){b.switches.post({url:"/config/switch/list",always:function(){e.hide(),c.fadeTo("fast",1)},success:function(a){$("#switches").html(a)},errorSibling:d})}),!0},SwitchView.prototype.deleteConfirm=function(a){a.preventDefault();var b=this,c=$(a.target),d=c.closest("tr"),e=c.attr("href"),f=$("#deleteSwitch"),g=f.find("a.btn-primary").first();return g.off("click"),g.click(function(){return b.switches.get({url:e,success:function(a){showSuccess($("#switches"),a.status_msg),d.fadeOut("slow",function(){$(this).remove()})},always:function(){f.modal("hide")},errorSibling:$("#switches")}),!1}),f.modal({show:!0}),!1},SwitchView.prototype.invalidateCache=function(a){a.preventDefault();var b=$("#modalSwitch"),c=b.find(".modal-body"),d=$(a.target),e=d.attr("href");this.switches.get({url:e,success:function(a){showSuccess(c.children().first(),a.status_msg)},errorSibling:c.children().first()})},SwitchView.prototype.searchSwitch=function(a,b){this.switches.post({url:"/config/switch/search",data:{json:1,all_or_any:"any","searches.0.name":"id","searches.0.op":"like","searches.0.value":a},success:function(a){var c=$.map(a.items,function(a){return a.id}),d=$("#modalSwitch #newMember"),e=d.closest(".control-group");0===c.length?e.addClass("error"):e.removeClass("error"),b(c)}})},$(function(){$("#section").on("change","#modalItem.syslogforwarded #all_logs",function(a){var b=a.currentTarget,c=$("#logs"),d=c.closest("div.control-group");b.checked?(console.log("checked"),d.addClass("hidden")):d.removeClass("hidden")})}),$(function(){function a(a){var b=$("#modalViolation");b.empty(),b.append(a),b.find(".switch").bootstrapSwitch(),b.find(".chzn-select").chosen({inherit_select_classes:!0,width:""}),b.find(".chzn-deselect").chosen({allow_single_deselect:!0,width:""}),b.one("shown",function(){var a=b.find(".event_triggers").first()[0];violationsView.event_triggers=JSON.parse(a.textContent||a.innerHTML),$("#actions").trigger("change")}),$(".trigger option").each(function(a){var b=$(this),c=b.val().split("::");if("accounting"==c[0].toLowerCase()){var d=violationsView.prettify_accounting(c[0],c[1]);b.html(d),b.closest("select").trigger("chosen:updated")}}),b.modal("show")}$("#section").on("click",'[href*="#modalViolation"]',function(b){var c=$(this).attr("href"),d=$("#section"),e=d.prev(".loader");return e.show(),d.fadeTo("fast",.5),$.ajax(c).always(function(){e.hide(),d.stop(),d.fadeTo("fast",1)}).done(function(b){a(b)}).fail(function(a){var b=getStatusMsg(a);$("body,html").animate({scrollTop:0},"fast"),showError($("#section h2"),b)}),!1}),$("#section").on("click","#createViolation",function(b){var c=$(this).attr("href"),d=$("#section"),e=d.prev(".loader");return e.show(),d.fadeTo("fast",.5),$.ajax(c).always(function(){e.hide(),d.stop(),d.fadeTo("fast",1)}).done(function(b){a(b)}).fail(function(a){$("body,html").animate({scrollTop:0},"fast");var b=getStatusMsg(a);showError($("#section h2"),b)}),!1}),$("#section").on("change","#viewTriggers select",function(){violationsView.recompute_triggers()}),$("#section").on("click",'[href*="/delete"]',function(a){if(a.preventDefault(),$(this).hasClass("disabled"))return!1;var b=$(this),c=b.attr("href"),d=b.closest("tr"),e=d.find("td"),f=$(e[1]).text();f||(f=$(e[0]).text());var g=$("#deleteViolation"),h=g.find("a.btn-primary").first();return g.find("h3 span").html(f),g.modal("show"),h.off("click"),h.click(function(a){a.preventDefault(),h.button("loading"),$.ajax(c).always(function(){g.modal("hide"),h.button("reset")}).done(function(a){d.remove();var b=$("#section table");0===b.find("tbody tr").length&&(b.remove(),$("#noViolation").removeClass("hidden"))}).fail(function(a){var b=getStatusMsg(a);showError($("#section h2"),b),h.button("reset")})}),!1}),$("body").on("change","#actions",function(a){var b=$(this).val(),c=$("#vclose").closest(".control-group");$.inArray("close",b)<0?c.fadeOut("fast"):c.fadeIn("fast");var d=$("#target_category").closest(".control-group");$.inArray("role",b)<0?d.fadeOut("fast"):d.fadeIn("fast");var e=$("#external_command").closest(".control-group");$.inArray("external",b)<0?e.fadeOut("fast"):e.fadeIn("fast"),e=$("#user_mail_message").closest(".control-group"),$.inArray("email_user",b)<0?e.fadeOut("fast"):e.fadeIn("fast"),e=$("#access_duration").closest(".control-group"),$.inArray("autoreg",b)<0?e.fadeOut("fast"):e.fadeIn("fast")}),$("body").on("switch-change","#violations .switch",function(a,b){a.preventDefault();var c=$(a.target);if(!c.attr("processing")){c.attr("processing","processing");var d=c.attr("data-href"),e=b.value?"yes":"no";d=d.replace(/enabled$/,e),$.ajax({type:"POST",url:d,data:""}).always(function(){c.attr("processing",null)}).done(function(a){showSuccess($("#section h2"),a.status_msg)}).fail(function(a){var b=getStatusMsg(a);showError($("#section h2"),b)})}}),$("body").on("submit",'form[name="violation"]',function(a){var b=$(this),c=b.find(".btn-primary"),d=$("#modalViolation"),e=d.find(".modal-body");return isFormValid(b)&&(resetAlert(e),c.button("loading"),$.ajax({type:"POST",url:b.attr("action"),data:b.serialize()}).always(function(){c.button("reset")}).done(function(){d.on("hidden",function(){$(window).hashchange()}),d.modal("hide")}).fail(function(a){var b=getStatusMsg(a);resetAlert(e),showPermanentError(e.children().first(),b)})),!1}),$.fn.typeahead.Constructor.prototype.select=function(){var a=this.$menu.find(".active").data("item");return this.$element.val(this.updater(a)).change(),this.hide()},$.fn.typeahead.Constructor.prototype.render=function(a){var b=this;return a=$(a).map(function(a,c){return a=$(b.options.item).data("item",c),a.find("a").html(b.highlighter(c)),a[0]}),a.first().addClass("active"),this.$menu.html(a),this},$("body").on("click",'[href="#deleteTrigger"]',function(a){return a.preventDefault(),$(a.target).closest(".control-group").remove(),$("#viewTriggers").find("select").length||$("#noTrigger").removeClass("hide"),violationsView.recompute_triggers(),!1}),$("body").on("click",'[href="#addTrigger"]',function(a){a.preventDefault();$(a.target);return $("#viewTriggers").slideUp(function(){$("#editedTrigger").html(ViolationsView.add_combined_trigger_form()),violationsView.previous_trigger_options=$("#editedTrigger .triggerButtons").html(),$("#editedTrigger .triggerButtons").html('<a href="#backEditTrigger" class="pull-left btn btn-default"><i class="icon  icon-chevron-left"></i></a>'),$("#editedTrigger .chzn-select").chosen({inherit_select_classes:!0,width:""}),$("#editTrigger").slideDown()}),!1}),$("body").on("click",'[href="#editTrigger"]',function(a){a.preventDefault();var b=$(a.target);return $("#viewTriggers").slideUp(function(){b.closest(".control-group").appendTo("#editedTrigger"),violationsView.previous_trigger_options=$("#editedTrigger .triggerButtons").html(),$("#editedTrigger .triggerButtons").html('<a href="#backEditTrigger" class="pull-left btn btn-default"><i class="icon  icon-chevron-left"></i></a>'),$("#editTrigger").slideDown()}),!1}),$("body").on("click",'[href="#backEditTrigger"]',function(a){a.preventDefault();var b=$(a.target);return $("#editTrigger").slideUp(function(){var a=b.closest(".control-group");a.find("select option:selected").length&&($("#noTrigger").addClass("hide"),a.find(".triggerButtons").html(violationsView.previous_trigger_options),a.appendTo("#viewTriggers")),$("#editedTrigger").html(""),$("#viewTriggers").slideDown()}),violationsView.recompute_triggers(),!1}),$("body").on("click","#add_trigger_part",function(a){a.preventDefault();var b=$("#tid"),c=b.val(),d=$("#trigger_type").find(":selected"),e=d.val();if(""===e)return!1;var f=d.text(),g=e+"::"+c,h=f+" : "+c;violationsView.append_trigger(g,h)}),$("body").on("click",".add_accounting_trigger",function(a){a.preventDefault();var b=$("#accounting_widget_direction").find(":selected").val(),c=$("#accounting_widget_amount").val(),d=$("#accounting_widget_unit").find(":selected").val(),e=$("#accounting_widget_window").find(":selected").val(),f=b+c+d+e,g="accounting::"+f;violationsView.append_trigger(g,violationsView.prettify_accounting("accounting",f))}),$("body").on("click",".add_trigger_part",function(a){a.preventDefault(),a.stopPropagation();var b=$(this).closest(".controls").find("select").find(":selected"),c=b.val(),d=$("#trigger_type").find(":selected"),e=d.val(),f=d.html(),g=e+"::"+c,h=f+" : "+b.html();violationsView.append_trigger(g,h)}),$("body").on("click","#violationSubmit",function(a){return a.preventDefault(),$("#editTrigger .control-group select").not("#trigger_type").not(".trigger_widget_select").appendTo("#viewTriggers"),violationsView.recompute_triggers(),$('[name="violation"]').submit(),!1}),$("body").on("change","#trigger_type",function(){var a=$("#trigger_type option:selected").val();$(".trigger_widget").slideUp(),$("."+a+"_triggers").slideDown()}),$("body").on("click",".trigger_widget a",function(){$("#modalViolation").modal("hide"),window.location=$(this).attr("href")})});var ViolationsView=function(){};ViolationsView.prototype.recompute_triggers=function(){var a={};$("#viewTriggers select").find(":selected").each(function(){var b=$(this),c=b.closest("select");c.uniqueId(),a[c.attr("id")]||(a[c.attr("id")]=[]),a[c.attr("id")].push(b.val())});var b=[];for(var c in a){var d;a[c].length>1?(d=a[c].join("&"),d="("+d+")"):d=a[c][0],b.push(d)}$("#trigger").val(b.join())},ViolationsView.add_combined_trigger_form=function(){return['<div class="control-group">','  <span class="triggerButtons">','    <a class="btn pull-left" href="#editTrigger">','      <i class="icon icon-pencil"></i>',"    </a>",'    <a class="btn btn-danger pull-left" href="#deleteTrigger">','      <i class="icon icon-remove"></i>',"    </a>","  </span>",'  <select multiple="multiple" class="chzn-select input-xxlarge">',"  </select>","</div>"].join(" ")},ViolationsView.prototype.prettify_accounting=function(a,b){var c,d=(a.toLowerCase(),b.toLowerCase());if("bandwidthexpired"==d)c="Bandwidth expired";else if("timeexpired"==d)c="Time expired";else{var e=/^(TOT|IN|OUT)([0-9]+)(B|KB|MB|GB|TB)([DWMY])$/,f=e.exec(b),g=f[1],h=f[2],i=f[3],j=f[4];c="","TOT"==g?c+="Total traffic over "+h+" "+i+" ":"IN"==g?c+="Inbound traffic over "+h+" "+i+" ":"OUT"==g&&(c+="Outbound traffic over "+h+" "+i+" "),"D"==j?c+="per day":"W"==j?c+="per week":"M"==j?c+="per month":"Y"==j&&(c+="per year")}return c},ViolationsView.prototype.append_trigger=function(a,b){var c=this;b||(b=a);var d=!1,e=$("#editedTrigger select").first();if(c.event_triggers.indexOf(a.split("::")[0].toLowerCase())>-1&&e.find("option:selected").each(function(){var a=$(this).val().split("::");c.event_triggers.indexOf(a[0].toLowerCase())>-1&&(d=$(this).html())}),d)return void showError($("#viewTriggers"),"There is already an evenemential trigger defined ("+d+"). Only one is allowed per combined trigger.");var f=!0;e.find("option").each(function(){if($(this).val()>a)return $('<option value="'+a+'" selected="selected">'+b+"</option>").insertBefore(this),f=!1,!1}),f&&e.append('<option value="'+a+'" selected="selected">'+b+"</option>"),e.trigger("chosen:updated")},ViolationsView.prototype.add_fingerbank_trigger=function(a,b,c){violationsView.append_trigger(a.model_stripped()+"::"+b,a.model_stripped()+" "+c)};var violationsView=new ViolationsView;
//# sourceMappingURL=configuration.js.map