function init(){$("#section").on("submit",'form[name="section"]',function(t){var e=$(this),i=e.attr("action"),n=isFormValid(e),o=e.find(".btn-primary");return n&&(o.button("loading"),$.ajax({type:"POST",url:i,data:e.serialize()}).always(function(){o.button("reset"),$("body,html").animate({scrollTop:0},"fast"),resetAlert($("#section"))}).done(function(t){showSuccess(e,t.status_msg)}).fail(function(t){var i=getStatusMsg(t);showPermanentError(e,i)})),!1}),$("#section").on("section.loaded",function(t){$(":input:not(:disabled):not([readonly]):visible:enabled:first[name]").focus(),$(".compound-input-btn-group .btn-group input").each(function(t,e){var i=$(e).attr("value");$(e).siblings('a[value="'+i+'"]').attr("default-value","yes")}),$("#tabView").find('[data-toggle="tab"]').first().tab("show")}),$("#section").on("reset",function(t){return $('.compound-input-btn-group .btn-group a[default-value="yes"]').click(),!0}),$("#section").on("show",'[href="#newTabView"]',function(t){var e=$(t.target),i=e.attr("href"),n=$(i),o=e.attr("data-href");return n.load(o,function(){n.find(".switch").bootstrapSwitch()}),!0});var t=$(".sidenav-category a").first().attr("href");t=t?t.replace(/^.*#/,"/"):"/configuration",$(window).hashchange(pfOnHashChange(updateSection,t)),$(window).hashchange(),activateNavLink()}$(function(){$("#section").on("click",'.sources [href*="/delete"]',function(t){if($(this).hasClass("disabled"))return!1;var e=$(this).attr("href"),i=$(this).closest("tr").find('[href*="/read"]').first().text(),n=$("#deleteSource"),o=n.find("a.btn-primary").first();return n.find("h3 span").html(i),n.modal({show:!0}),o.off("click"),o.click(function(){return $.ajax(e).always(function(){n.modal("hide")}).done(function(t){$(window).hashchange()}).fail(function(t){$("body,html").animate({scrollTop:0},"fast");var e=getStatusMsg(t);showError($("#section h2"),e)}),!1}),!1}),$("#section").on("click","#testSource",function(t){t.preventDefault();var e=$(this),i=e.closest("form"),n=isFormValid(i);resetAlert($("#section")),n&&$.ajax({type:"POST",url:e.attr("href"),data:i.serialize()}).done(function(t){showSuccess(i,t.status_msg)}).fail(function(t){var e=getStatusMsg(t);showPermanentError(i,e)})}),$("#section").on("submit",'form[name="create_source"]',function(t){t.preventDefault();var e=$(this);isFormValid(e)&&(resetAlert($("#section")),$.ajax({type:"POST",url:e.attr("action"),data:e.serialize()}).done(function(t,e,i){location.hash=i.getResponseHeader("Location")}).fail(function(t){$("body,html").animate({scrollTop:0},"fast");var i=getStatusMsg(t);showPermanentError(e,i)}))}),$("#section").on("submit",'form[name="source"]',function(t){t.preventDefault();var e=$(this),i=e.find(".btn-primary");isFormValid(e)&&(i.button("loading"),resetAlert($("#section")),$.ajax({type:"POST",url:e.attr("action"),data:e.serialize()}).always(function(){i.button("reset")}).done(function(t,e,i){$("#section").fadeOut("fast",function(){$(this).empty(),$(this).html(t),$(this).fadeIn("fast",function(){$(".chzn-select").chosen(),$("#id").focus()})})}).fail(function(t){$("body,html").animate({scrollTop:0},"fast");var i=getStatusMsg(t);showPermanentError(e,i)}))}),$("#section").on("click","#sourceRules a:not(.btn-icon)",function(t){var e=$("#modalRule"),i=$(this).attr("href"),n=$("#section"),o=n.prev(".loader");return o.show(),n.fadeTo("fast",.5),e.empty(),$.ajax(i).always(function(){o.hide(),n.stop(),n.fadeTo("fast",1)}).done(function(t){e.append(t),e.one("shown",function(){$("#id").focus()}),e.modal({shown:!0});var i=$("#class"),n=$("#ruleActions").children("tbody").children("tr");"administration"==i.find(":selected").attr("value")?(n.find('option[data-rule-class="administration"]').removeClass("hidden"),n.find('option[data-rule-class="authentication"]').addClass("hidden")):"authentication"==i.find(":selected").attr("value")&&(n.find('option[data-rule-class="authentication"]').removeClass("hidden"),n.find('option[data-rule-class="administration"]').addClass("hidden"))}).fail(function(t){$("body,html").animate({scrollTop:0},"fast");var e=getStatusMsg(t);showError($("#section h3"),e)}),!1}),$("#section").on("click","#createRule",function(t){var e=$("#modalRule"),i=$(this).attr("href"),n=$("#section"),o=n.prev(".loader");return o.show(),n.fadeTo("fast",.5),e.empty(),$.ajax(i).always(function(){o.hide(),n.stop(),n.fadeTo("fast",1)}).done(function(t){e.append(t),e.one("shown",function(){$("#id").focus(),$("#class").trigger("change")}),e.modal({shown:!0})}).fail(function(t){$("body,html").animate({scrollTop:0},"fast");var e=getStatusMsg(t);showError($("#section h3"),e)}),!1}),$("#section").on("submit",'form[name="rule"]',function(t){var e=$(this),i=e.find(".btn-primary"),n=$("#modalRule"),o=n.find(".modal-body").first();return isFormValid(e)&&(i.button("loading"),resetAlert(o),e.find("tr.hidden :input").attr("disabled","disabled"),$.ajax({type:"POST",url:e.attr("action"),data:e.serialize()}).always(function(){i.button("reset")}).done(function(t){n.one("hidden",function(){$("#sourceRulesEmpty").closest(".control-group").fadeOut("fast",function(){$(this).empty(),$(this).html(t),$(this).fadeIn("fast",function(){$(".chzn-select").chosen({width:""})})})}),n.modal("hide")}).fail(function(t){var i=getStatusMsg(t);showPermanentError(o.children().first(),i),e.find("tr.hidden :input").removeAttr("disabled")})),!1}),$("#section").on("change","#class",function(t){var e=$(this),i=$("#ruleActions");i.find("tr:not(.hidden)").remove();var n=i.children("tbody").children(".hidden").first();"administration"==e.find(":selected").attr("value")?(n.find('option[data-rule-class="administration"]').removeClass("hidden"),n.find('option[data-rule-class="administration"]').removeAttr("disabled"),n.find('option[data-rule-class="authentication"]').addClass("hidden"),n.find('option[data-rule-class="authentication"]').attr("disabled","disabled")):"authentication"==e.find(":selected").attr("value")&&(n.find('option[data-rule-class="authentication"]').removeClass("hidden"),n.find('option[data-rule-class="authentication"]').removeAttr("disabled"),n.find('option[data-rule-class="administration"]').addClass("hidden"),n.find('option[data-rule-class="administration"]').attr("disabled","disabled")),$("#ruleActions tr:not(.hidden) select[name$=type]").each(function(){updateAction($(this),!1)}),i.trigger("addrow"),i.find("tr").find('[href="#delete"]').addClass("hidden")}),$("body").on("click",'#ruleConditionsEmpty [href="#add"]',function(t){return $("#ruleConditions").trigger("addrow"),!1}),$("#section").on("show","#modalRule",function(t){"modalRule"==t.target.id&&($("#templates").find("option").removeAttr("id"),$("#ruleConditions tr:not(.hidden) select[name$=attribute]").each(function(){updateCondition($(this))}),$("#ruleActions tr:not(.hidden) select[name$=type]").each(function(){updateAction($(this),!0)}))}),$("#section").on("admin.added","#ruleConditions tr",function(t){var e=$(this).find("select[name$=attribute]").first();updateCondition(e)}),$("#section").on("change","#ruleConditions select[name$=attribute]",function(t){updateCondition($(this))}),$("#section").on("change","#ruleActions select[name$=type]",function(t){updateAction($(this))}),$("#section").on("admin.added","#ruleActions tr:not(.hidden)",function(t){var e=$(this).find("select[name$=type]").first();updateAction(e)})});function initVariableList(t){$("#variable_list").on("click",".insert-into-file",function(e){var i=$(this).attr("data-content");return t.insert(i),t.focus(),!1})}function initShowLinesCheckBox(t){var e=$("#file-editor-show-lines"),i=t.renderer;e.off("click"),e.click(function(t){return i.setShowGutter(this.checked),!0}),i.setShowGutter(e.is(":checked"))}function initSaveModal(t,e){var i=$("#saveFile"),n=i.find("a.btn-primary").first();n.off("click"),n.click(function(n){var o=$("#file_editor_form");e.val(t.getValue()),submitFormHideModal(i,o)})}function initCancelModal(){$("#cancelEdit").find("a.btn-primary").first().click(function(t){window.location=$(this).attr("href")})}function initEditor(t,e){var i=$("#cancel-link"),n=$(".form-actions a.btn.editorToggle"),o=function(e){i.attr("data-toggle","modal"),n.toggleClass("disabled"),t.removeEventListener("change",o)};t.setTheme("ace/theme/monokai"),t.getSession().setMode("ace/mode/html"),t.on("change",o),t.focus(),$("#rename_file").on("submit",function(){return submitFormHideModalGoToLocation($("#renameModal"),$(this)),!1}),$("#resetContent").find("a.btn-primary").first().click(function(r){t.setValue(e.val(),-1),i.removeAttr("data-modal"),n.toggleClass("disabled"),t.on("change",o)})}function initRenameForm(t){var e=$("#file_name"),i=e.next().first(),n=e.find("a").first(),o=i.next().first(),r=i.children().first(),a=$("#rename_file");t.on("click","#file_name a",function(t){o.html(r.val()),r.width(o.width()+5),i.removeClass("hidden"),n.addClass("hidden"),r.focus()}),$("#new_file_name").keyup(function(t){var e=$(this);27==t.keyCode?e.focusout():(o.html(e.val()),e.width(o.width()+5))}),$("#new_file_name").focusout(function(t){o.html(r.val()),r.width(o.width()+5),i.addClass("hidden"),n.removeClass("hidden"),a[0].reset()})}function initEditorPage(t){var e=$("#file_content"),i=ace.edit("editor");initVariableList(i),initShowLinesCheckBox(i),initSaveModal(i,e),initCancelModal(),initEditor(i,e),initRenameForm(t)}function initCollapse(t){t.on("show hidden",".collapse",function(e){var i=$(this);i.closest("tr").first().swap_class("toggle");t.find('[data-target="#'+i.attr("id")+'"]').find("[data-swap]").swap_class("toggle"),e.stopPropagation()})}function initCopyModal(t){var e=$("#copyModal"),i=e.find(".btn-primary").first();e.on("shown",function(){$(this).find(":input:first").focus()}),e.on("hidden",function(){$(this).data("modal").$element.removeData()}),i.off("click"),i.click(function(t){var i=e.find("#copyModalForm");submitFormHideModal(e,i)}),t.on("submit","#copyModalForm",function(){return submitFormHideModal(e,$(this)),!1})}function submitFormHideModalGoToLocation(t,e){$.ajax({async:!1,url:e.attr("action"),type:e.attr("method")||"POST",data:e.serialize()}).always(function(){t.modal("hide")}).done(function(t,e,i){location.hash=i.getResponseHeader("Location")}).fail(function(t){$("body,html").animate({scrollTop:0},"fast");var e=getStatusMsg(t);showError($("#section h2"),e)})}function initNewFileModal(t){var e=$("#newFileModal"),i=e.find(".btn-primary").first();e.on("hidden",function(){$(this).data("modal").$element.removeData()}),e.on("shown",function(){$(this).find(":input:first").focus()}),i.off("click"),i.click(function(t){var i=e.find("#newFileModalForm");return submitFormHideModalGoToLocation(e,i),!1}),t.on("submit","#newFileModalForm",function(){return submitFormHideModalGoToLocation(e,$(this)),!1})}function disabledLinks(t){t.on("click",".disabled",function(){return!1})}function initIndexPage(t){}function initCreatePage(t){var e=t.find("#create_profile"),i=e.find(".btn-primary").first();i.off("click"),i.click(function(t){var i=isFormValid(e);return i||$("body,html").animate({scrollTop:0},"fast"),i});var n=$("#createProfile"),o=n.find(".btn-primary").first();o.off("click"),o.click(function(t){return submitFormHideModalGoToLocation(n,e),!1}),initReadPage(t)}function initReadPage(t){updateDynamicRowsAfterRemove($("#locale")),updateDynamicRowsAfterRemove($("#filter")),$("#locale, #sources").on("admin.added","tr",function(t){var e=$(this),i=e.siblings(":not(.hidden)").find("select option:selected"),n=e.find("select");n.find("option:selected").removeAttr("selected");var o=n.find('option[value!=""]');o.each(function(t,e){var n='[value="'+e.value+'"]';if(0===i.filter(n).length)return $(e).attr("selected","selected"),!1});var r=e.siblings(":not(.hidden)").addBack();r.length==o.length&&r.find('[href="#add"]').addClass("hidden")}),$("#sources").on("change","select",function(t){var e=$(this),i=e.closest("tr");"exclusive"==e.find(":selected").attr("data-source-class")?(i.siblings(":not(.hidden)").find('[href="#delete"]').click(),i.find('[href="#add"]').addClass("hidden")):i.find('[href="#add"]').removeClass("hidden")}),$("#filter").on("change",'select[name$=".type"]',function(t){updateFilterMatchInput($(t.currentTarget),!1)}),$('[id$="Empty"]').on("click",'[href="#add"]',function(t){var e=/(.+)Empty/.exec(t.delegateTarget.id),i=e[1],n=e[0];return $("#"+i).trigger("addrow"),$("#"+n).addClass("hidden"),!1}),$('select[name$=".type"]:not(:disabled)').each(function(t,e){updateFilterMatchInput($(e),!0)})}function updateFilterMatchInput(t,e){var i=t.next(),n=t.val(),o=$("#"+n+"_filter_match");0===o.length&&(o=$("#default_filter_match")),o.length&&(changeInputFromTemplate(i,o,e),"switch"==n&&t.next().typeahead({source:searchSwitchesGenerator($("#section h2")),minLength:2,items:11,matcher:function(t){return!0}}))}function initTemplatesPage(t){initCopyModal(t),initCollapse(t),initNewFileModal(t)}function connectionProfileGlobalInit(t){initWidgets(t.find(".chzn-select")),disabledLinks(t)}$("#section").on("section.loaded",function(t){for(var e=[{id:"#connection_profile_file_editor",initializer:initEditorPage},{id:"#connection_profile_files",initializer:initTemplatesPage},{id:"#connection_profile_index",initializer:initIndexPage},{id:"#connection_profile_create",initializer:initCreatePage},{id:"#connection_profile_read",initializer:initReadPage}],i=0;i<e.length;i++){var n=e[i],o=$(n.id);o.length&&(connectionProfileGlobalInit(o),n.initializer(o))}});var domainView;$(function(){var t=new Domains;domainView=new DomainView({items:t,parent:$("#section")})});function Domains(){}Domains.prototype=new Items,Domains.prototype.id="#domains",Domains.prototype.formName="modalDomain",Domains.prototype.modalId="#modalDomain",Domains.prototype.createSelector=".createDomain";function DomainView(t){ItemView.call(this,t);this.parent=t.parent,this.items=t.items;var e=this.items.id;t.parent.off("click",e+' [href$="/delete"]');var i=$.proxy(this.deleteItem,this);t.parent.on("click",e+' [href$="/delete"]',i);var n=$.proxy(this.updateAndJoinDomain,this);t.parent.on("click","#saveAndJoinDomain",n)}DomainView.prototype=function(){function t(){}return t.prototype=ItemView.prototype,new t}(),DomainView.prototype.constructor=ItemView,DomainView.prototype.showWait=function(t){$("#modalDomainWait h3").html(t),$("#domainProgressBar").css("width","1%"),$("#modalDomainWait").modal("show")},DomainView.prototype.updateAndJoinDomain=function(t){t.preventDefault();var e=this,i=$(t.target),n=i.closest("form"),o=($(this.items.id),n.find(".btn")),r=n.closest(".modal");if(isFormValid(n)){var a=r.find(".modal-body").first();resetAlert(a),n.find("tr.hidden :input").attr("disabled","disabled"),r.modal("hide"),e.showWait("The server is currently joining the domain"),this.items.post({url:i.attr("href"),data:n.serialize(),always:function(){n.find("tr.hidden :input").removeAttr("disabled"),o.button("reset"),$("#modalDomainWait").modal("hide")},success:function(t){var i=$("<div></div>");i.append("<h3>Result of the domain join</h3>"),i.append($("<pre>"+t.items.join_output+"</pre>")),e.showResultModal(i),e.list()},errorSibling:$("#section")})}},DomainView.prototype.showResultModal=function(t,e){$("#modalDomainInfo .modal-header h3").html(t),$("#modalDomainInfo .modal-body").html(e),$("#modalDomainInfo").modal("show")},DomainView.prototype.deleteItem=function(t){var e=this,i=t;if(t.preventDefault(),$(this).hasClass("disabled"))return!1;var n=$(this),o=(n.attr("href"),n.closest("tr").find("td")),r=$(o[1]).text();r||(r=$(o[0]).text());var a=$("#deleteItem"),s=a.find("a.btn-primary").first();a.find("h3 span").html(r),a.modal("show"),s.off("click"),s.click(function(t){t.preventDefault(),s.button("loading"),t.preventDefault();var n=$(e.items.id),o=$(i.target),r=(o.closest("tr"),o.attr("href"));e.items.get({url:r,always:function(){s.button("reset"),a.modal("hide")},success:function(i){showSuccess(n,i.status_msg),e.list(t)},errorSibling:n})})},DomainView.prototype.list=function(){var t=$("#domains");this.listRefresh(t.attr("data-list-uri"))},DomainView.prototype.listRefresh=function(t){var e=$("#domains"),i=this;e.fadeTo("fast",.5,function(){i.items.get({url:t,always:function(){e.fadeTo("fast",1)},success:function(t){e.replaceWith(t)},errorSibling:$("#domains")})})},DomainView.prototype.setPassword=function(t,e){var i=$("#modalDomainSetPassword-"+t),n=$("#modalDomainSetPassword-"+t+" form");n.submit(function(t){return t.preventDefault(),$.ajax({url:n.attr("action"),type:"POST",data:n.serialize()}).done(function(t){i.modal("hide"),n.find('input[name="username"]').val(""),n.find('input[name="password"]').val(""),e()}).fail(function(t){$("body,html").animate({scrollTop:0},"fast");var e=getStatusMsg(t);n.find('input[name="username"]').val(""),n.find('input[name="password"]').val(""),showError($("#section h2"),e)}),!1}),i.modal("show")},$(document).ready(function(){$("#section").on("click",".rejoin_domain",function(t){var e=this;t.preventDefault();var i=$(t.target).parent().parent().children().children().html();return domainView.setPassword(i,function(){var t=domainView,i=$(e),n=i.html();i.attr("disabled","disabled"),i.html("Rejoining domain"),domainView.showWait("The server is rejoining the domain."),$.ajax({url:i.attr("href"),type:"GET"}).done(function(e){$("body,html").animate({scrollTop:0},"fast");var o=$("<div></div>");o.append("<h3>Result of the domain leave</h3>"),o.append($("<pre>"+e.items.leave_output+"</pre>")),o.append("<h3>Result of the domain join</h3>"),o.append($("<pre>"+e.items.join_output+"</pre>")),$("#modalDomainWait").modal("hide"),domainView.showResultModal(o),t.list(),i.html(n),i.removeAttr("disabled")}).fail(function(t){$("body,html").animate({scrollTop:0},"fast");var e=getStatusMsg(t);showError($("#section h2"),e),i.html(n),i.removeAttr("disabled")})}),!1}),$("#section").on("click","#refresh_domains",function(t){t.preventDefault();var e=$("#refresh_domains").html();$("#refresh_domains").attr("disabled","disabled"),$("#refresh_domains").html("Refreshing domains"),domainView.showWait("The server is refreshing the configuration."),$.ajax({url:$("#refresh_domains").attr("href"),type:"GET"}).done(function(t){$("body,html").animate({scrollTop:0},"fast"),$("#modalDomainWait").modal("hide"),showSuccess($("#section h2"),t.status_msg),$("#refresh_domains").html(e),$("#refresh_domains").removeAttr("disabled")}).fail(function(t){$("body,html").animate({scrollTop:0},"fast");var i=getStatusMsg(t);showError($("#section h2"),i),$("#refresh_domains").html(e),$("#refresh_domains").removeAttr("disabled")})}),setInterval(function(){var t=$("#domainProgressBar").width();if(t||0===t){100==(t=100*t/$("#domainProgressBar").offsetParent().width())?t=0:(t+=10)>100&&(t=100),$("#domainProgressBar").css("width",t+"%")}},15e3)});var filtersView;$(function(){filtersView=new FiltersView({parent:$("#section")})});var FiltersView=function(t){this.parent=t.parent;var e=$.proxy(this.update,this);t.parent.on("submit","#filtersForm",e);var i=$.proxy(this.revert,this);t.parent.on("click","#filtersRevert",i);var n=$.proxy(this.setupEditor,this);t.parent.on("section.loaded",n)};FiltersView.prototype.setupEditor=function(){$("#editor").length&&(this.editor=ace.edit("editor"),this.editor.setTheme("ace/theme/monokai"),this.editor.getSession().setMode("ace/mode/perl"),this.disableButtons(),this.initialValue=this.editor.getValue())},FiltersView.prototype.revert=function(t){this.editor.setValue(this.initialValue,-1),this.disableButtons()},FiltersView.prototype.disableButtons=function(){$("#filtersForm .btn").addClass("disabled"),this.enableButtonsProxy=$.proxy(this.enableButtons,this),this.editor.on("change",this.enableButtonsProxy)},FiltersView.prototype.enableButtons=function(){$("#filtersForm .btn").removeClass("disabled"),this.editor.removeEventListener("change",this.enableButtonsProxy)},FiltersView.prototype.update=function(t){var e=this;t.preventDefault();var i=$(t.target);return $.ajax({url:i.attr("action"),type:"POST",data:{content:this.editor.getValue()}}).done(function(t){showSuccess(i,t.status_msg),e.initialValue=e.editor.getValue(),e.disableButtons()}).fail(function(t){var e=getStatusMsg(t);showPermanentError(i,e)}),!1},$(function(){var t=new FingerbankDevices;new FingerbankDeviceView({items:t,parent:$("#section")})});var FingerbankDevices=function(){};FingerbankDevices.prototype=new Items,FingerbankDevices.prototype.id="#fingerbankdevices",FingerbankDevices.prototype.formName="modalFingerbankDevice",FingerbankDevices.prototype.modalId="#modalFingerbankDevice",FingerbankDevices.prototype.createSelector=".createFingerbankDevice";var FingerbankDeviceView=function(t){ItemView.call(this,t);var e=$.proxy(this.showChildren,this);t.parent.on("click",'#fingerbankdevices [href$="/children"]',e);var i=$.proxy(this.readItem,this);t.parent.on("click",'#fingerbankdevices [href$="/add_child"]',i),t.parent.on("show hidden",".collapse",function(t){$(this).closest("tr").first().toggleClass("hidden"),t.stopPropagation()})};FingerbankDeviceView.prototype=function(){function t(){}return t.prototype=ItemView.prototype,new t}(),FingerbankDeviceView.prototype.constructor=FingerbankDeviceView,FingerbankDeviceView.prototype.showChildren=function(t){var e=$(t.currentTarget),i=e.attr("href"),n=e.attr("data-target"),o=$(n),r=o.closest("tr");return o.collapse({toggle:!1}),r.hasClass("hidden")?this.items.get({url:i,success:function(t){o.find("table").html(t),o.collapse("show")},errorSibling:$(this.id)}):o.collapse("hide"),!1},$(function(){$("#section").on("submit","#fingerbankonboard",function(t){return updateSectionFromForm($("#fingerbankonboard")),!1})}),$(function(){var t=new FloatingDevices;new FloatingDeviceView({items:t,parent:$("#section")})});var FloatingDevices=function(){};FloatingDevices.prototype=new Items,FloatingDevices.prototype.id="#floatingdevices",FloatingDevices.prototype.formName="modalFloatingDevice",FloatingDevices.prototype.modalId="#modalFloatingDevice",FloatingDevices.prototype.createSelector=".createFloatingDevice";var FloatingDeviceView=function(t){ItemView.call(this,t);var e=this;this.parent=t.parent,this.items=t.items,t.parent.on("change",'form[name="modalFloatingDevice"] input[name="trunkPort"]',this.toggleTaggedVlan),t.parent.on("show","#modalFloatingDevice",function(t){var i=$('form[name="modalFloatingDevice"] input[name="trunkPort"]').first();$.proxy(e.toggleTaggedVlan,i)(t)})};FloatingDeviceView.prototype=function(){function t(){}return t.prototype=ItemView.prototype,new t}(),FloatingDeviceView.prototype.constructor=FloatingDeviceView,FloatingDeviceView.prototype.toggleTaggedVlan=function(t){var e=$(this),i=e.closest("form").find('input[name="taggedVlan"]').first();e.is(":checked")?i.removeAttr("disabled"):i.attr("disabled",1)},$(function(){var t=new Interfaces,e=new InterfaceView({interfaces:t,parent:$("#section")}),i=$.proxy(e.readInterface,e);$("#section").on("click","#createNetwork",i)}),$(function(){new ItemView({items:new Items,parent:$("#section")})});function Items(){}Items.prototype.id="#items",Items.prototype.formName="modalItem",Items.prototype.modalId="#modalItem",Items.prototype.createSelector=".createItem",Items.prototype.get=function(t){$.ajax({url:t.url}).always(t.always).done(t.success).fail(function(e){var i=getStatusMsg(e);showPermanentError(t.errorSibling,i)})},Items.prototype.post=function(t){$.ajax({url:t.url,type:"POST",data:t.data}).always(t.always).done(t.success).fail(function(e){var i=getStatusMsg(e);showPermanentError(t.errorSibling,i)})};function ItemView(t){this.parent=t.parent;var e=t.items;this.items=e,this.disableToggle=!1;var i=e.id,n=e.formName,o=$.proxy(this.readItem,this);t.parent.on("click",i+' .item [href$="/read"]',o),t.parent.on("click",i+' [href$="/clone"]',o),t.parent.on("click",e.createSelector,o);var r=$.proxy(this.updateItem,this);t.parent.on("submit",'form[name="'+n+'"]',r);var a=$.proxy(this.deleteItem,this);t.parent.on("click",i+' [href$="/delete"]',a);var s=$.proxy(this.listItems,this);t.parent.on("click",i+' [href*="/list"]',s);var c=$.proxy(this.search,this);t.parent.on("submit",'form[name="search"]',c);var l=$.proxy(this.resetSearch,this);t.parent.on("reset",'form[name="search"]',l);var d=$.proxy(this.searchNext,this);t.parent.on("click",i+' [href*="/search"]',d)}ItemView.prototype.readItem=function(t){t.preventDefault();var e=$(this.items.modalId),i=$("#section"),n=t.target;"A"!=n.nodeName&&(n=n.parentNode),i.loader(),i.fadeTo("fast",.5),e.empty(),$(".chosen-drop").remove(),this.items.get({url:$(n).attr("href"),always:function(){i.stop(),i.fadeTo("fast",1,function(){i.loader("hide")})},success:function(t){e.append(t),e.find(".chzn-select").chosen({width:""}),e.find(".chzn-deselect").chosen({allow_single_deselect:!0,width:""}),fixChosenClipping(e.find(".chzn-select, .chzn-deselect")),e.one("shown",function(){e.find(":input:visible").first().focus()}),e.modal({shown:!0})},errorSibling:i.find("h2").first()})},ItemView.prototype.updateItem=function(t){t.preventDefault();var e=this,i=$(t.target),n=$(this.items.id),o=i.find(".btn-primary"),r=i.closest(".modal");if(isFormValid(i)){var a=r.find(".modal-body").first();resetAlert(a),o.button("loading"),i.find("tr.hidden :input").attr("disabled","disabled"),this.items.post({url:i.attr("action"),data:i.serialize(),always:function(){i.find("tr.hidden :input").removeAttr("disabled"),o.button("reset")},success:function(t){r.modal("toggle"),showSuccess(n,t.status_msg),e.list()},errorSibling:a.children().first()})}},ItemView.prototype.list=function(){var t=$(this.items.id);this.items.get({url:t.attr("data-list-uri"),success:function(e){t.html(e)},errorSibling:t})},ItemView.prototype.deleteItem=function(t){t.preventDefault();var e=$(this.items.id),i=$(t.target),n=this,o=(i.closest("tr"),i.attr("href"));return this.items.get({url:o,success:function(i){showSuccess(e,i.status_msg),n.list(t)},errorSibling:e}),!1},ItemView.prototype.list=function(){var t=$(this.items.id);this.listRefresh(t.attr("data-list-uri"))},ItemView.prototype.listItems=function(t){t.preventDefault();var e=$(t.target);this.listRefresh(e.attr("href"))},ItemView.prototype.listRefresh=function(t){var e=$(this.items.id),i=this;e.fadeTo("fast",.5,function(){i.items.get({url:t,always:function(){e.fadeTo("fast",1)},success:function(t){e.replaceWith(t)},errorSibling:e})})},ItemView.prototype.resetSearch=function(t){return t.preventDefault(),this.list(),!1},ItemView.prototype.search=function(t){t.preventDefault();var e=$(t.target),i=e.attr("action");return this.searchRefresh(i,e),!1},ItemView.prototype.searchNext=function(t){t.preventDefault();var e=$("#search"),i=$(t.target).attr("href");return this.searchRefresh(i,e),!1},ItemView.prototype.searchRefresh=function(t,e){var i=$(this.items.id),n=this;return i.fadeTo("fast",.5,function(){n.items.post({url:t,data:e.serialize(),always:function(){i.fadeTo("fast",1)},success:function(t){i.replaceWith(t)},errorSibling:i})}),!1},$(function(){var t=new Pfdetects;new PfdetectView({items:t,parent:$("#section")})});var Pfdetects=function(){};Pfdetects.prototype=new Items,Pfdetects.prototype.id="#pfdetects",Pfdetects.prototype.formName="modalPfdetect",Pfdetects.prototype.modalId="#modalPfdetect",Pfdetects.prototype.createSelector=".createPfdetect";var PfdetectView=function(t){ItemView.call(this,t);this.parent=t.parent;var e=t.items;this.items=e;var i=e.id;e.formName;t.parent.off("click",i+' [href$="/clone"]');var n=$.proxy(this.showTestRegex,this);t.parent.on("show","#test-regex",n);var o=$.proxy(this.toggleResults,this);t.parent.on("shown","#test-regex-results .collapse",o),t.parent.on("hidden","#test-regex-results .collapse",o);var r=$.proxy(this.testRegex,this);t.parent.on("click","#test-regex-btn",r);var a=this.handleChangeApiMethod;t.parent.on("change",'form[name="modalPfdetect"] [name$=".api_method"]',a)};PfdetectView.prototype=function(){function t(){}return t.prototype=ItemView.prototype,new t}(),PfdetectView.prototype.constructor=PfdetectView,PfdetectView.prototype.updateItem=function(t){t.preventDefault();var e=$(t.target),i=($(this.items.id),$("#section"),e.find(".btn-primary"));if(isFormValid(e)){var n=e.find("h2").first();i.button("loading"),this.items.post({url:e.attr("action"),data:e.serialize(),always:function(){i.button("reset")},success:function(t,e,i){var o=i.getResponseHeader("Location");showSuccess(n,t.status_msg),o&&(location.hash=o)},errorSibling:n})}},PfdetectView.prototype.toggleResults=function(t){var e=$(t.currentTarget),i=$('a[data-target="#'+e.attr("id")+'"] i');i.length&&i.toggleClass("icon-minus-circle",1)},PfdetectView.prototype.testRegex=function(t){t.preventDefault();var e=$(t.target),i=$(e.closest("form").first());if(isFormValid(i)){var n=e.attr("data-test-action"),o=$("#section");e.button("loading"),this.items.post({url:n,data:i.serialize(),always:function(){e.button("reset")},success:function(t){showSuccess(o.find("h2").first(),"Passed"),$("#test-regex-results").html(t)},errorSibling:o.find("h2").first()})}return!1},PfdetectView.prototype.showTestRegex=function(t){$('textarea[name="loglines"]').removeAttr("disabled")},PfdetectView.prototype.handleChangeApiMethod=function(t){var e=$(t.currentTarget),i=e.next(),n=e.val(),o=$("#"+n+"_api_parameters");0===o.length&&(o=$("#default_api_parameters")),o.length&&changeInputFromTemplate(i,o)};function submitFormGoToLocation(t){$.ajax({async:!1,url:t.attr("action"),type:t.attr("method")||"POST",data:t.serialize()}).done(function(t,e,i){location.hash=i.getResponseHeader("Location")}).fail(function(t){$("body,html").animate({scrollTop:0},"fast");var e=getStatusMsg(t);showError($("#section h2"),e)})}$("#section").on("click",'[id$="Empty"]',function(t){t.preventDefault();var e=/(.+)Empty/.exec($(t.target).closest(".unwell").attr("id")),i=e[1],n=e[0];return $("#"+i).trigger("addrow"),$("#"+n).addClass("hidden"),!1}),$("#section").on("submit",'form[name="formItem"]',function(t){t.preventDefault();var e=$(this),i=e.find(".btn-primary"),n=isFormValid(e);$('select[name$=".type"]:not(:disabled)').each(function(t,i){"Select an option"==$(i).val()&&(n=!1,showPermanentError(e,"Please select a valid action."))}),n&&(i.button("loading"),resetAlert($("#section")),$.ajax({type:"POST",url:e.attr("action"),data:e.serialize()}).always(function(){i.button("reset")}).done(function(t,i,n){showSuccess(e,"Saved"),window.location.hash="#config/portal_module/"+e.find('input[name="id"]').val()+"/read"}).fail(function(t){$("body,html").animate({scrollTop:0},"fast");var i=getStatusMsg(t);showPermanentError(e,i)}))}),$("#section").on("click",".delete-portal-module",function(t){t.preventDefault();var e=$(t.target);return e.button("loading"),$.ajax({type:"GET",url:e.attr("href")}).always(function(){}).done(function(t,i,n){showSuccess(e.closest(".table"),"Deleted"),e.closest("tr").remove()}).fail(function(t){e.button("reset"),$("body,html").animate({scrollTop:0},"fast");var i=getStatusMsg(t);showPermanentError(e.closest(".table"),i)}),!1}),$("#section").on("click",".expand",function(t){return t.preventDefault(),$(t.target).hide(function(){$($(t.target).attr("data-expand")).slideDown()}),!1}),$("#section").on("change",'#actions select[name$=".type"]',function(t){updateActionMatchInput($(t.currentTarget),!1)}),$("#section").on("click",'#actionsContainer a[href="#add"]',function(t){setTimeout(initActionMatchInput,3e3)}),$("#section").on("section.loaded",function(t){var e=document.getElementById("modulesTreeData");if(e){var i=JSON.parse(e.textContent||e.innerHTML);$("#modulesTree").tree({data:i}),$("#modulesTree").bind("tree.click",function(t){var e=t.node;window.location.hash="#config/portal_module/"+e.id+"/read"})}initActionMatchInput()});function initActionMatchInput(){$('select[name$=".type"]:not(:disabled)').each(function(t,e){updateActionMatchInput($(e),!0)})}function updateActionMatchInput(t,e){var i=t.next(),n=t.val(),o=$("#"+n+"_action_match");0===o.length&&(o=$("#default_action_match")),o.length&&(changeInputFromTemplate(i,o,e),"switch"==n&&t.next().typeahead({source:searchSwitchesGenerator($("#section h2")),minLength:2,items:11,matcher:function(t){return!0}}))}$(function(){var t=new Provisioners;new ProvisionerView({items:t,parent:$("#section")})});var Provisioners=function(){};Provisioners.prototype=new Items,Provisioners.prototype.id="#provisioners",Provisioners.prototype.formName="modalProvisioner",Provisioners.prototype.modalId="#modalProvisioner",Provisioners.prototype.createSelector=".createProvisioner";var ProvisionerView=function(t){ItemView.call(this,t);this.parent=t.parent,this.items=t.items;var e=$.proxy(this.toggleInputs,this);t.parent.on("change",'form[name="modalProvisioner"] select[name="security_type"]',e),t.parent.on("change",'form[name="modalProvisioner"] select[name="eap_type"]',e),t.parent.on("show","#modalProvisioner",e)};ProvisionerView.prototype=function(){function t(){}return t.prototype=ItemView.prototype,new t}(),ProvisionerView.prototype.constructor=ProvisionerView,ProvisionerView.prototype.toggleInputs=function(t){this.togglePkiProvider(t),this.toggleWifiKey(t),this.toggleEapType(t),this.toggleServerCertificate(t)},ProvisionerView.prototype.toggleWifiKey=function(t){var e=$("#security_type option:selected").text(),i=$("#eap_type option:selected").text(),n=$("#passcode").closest(".control-group");"Open"!=e&&"No EAP"==i?n.show():n.hide()},ProvisionerView.prototype.toggleEapType=function(t){var e=$("#security_type option:selected").text(),i=$("#eap_type").closest(".control-group");"WPA2"==e?i.show():i.hide()},ProvisionerView.prototype.togglePkiProvider=function(t){var e=$("#security_type option:selected").text(),i=$("#eap_type option:selected").text(),n=$("#pki_provider").closest(".control-group");"WPA2"==e&&"EAP-TLS"==i?n.show():n.hide()},ProvisionerView.prototype.toggleServerCertificate=function(t){var e=$("#security_type option:selected").text(),i=$("#eap_type option:selected").text(),n=$("#server_certificate_path").closest(".control-group");"WPA2"==e&&"PEAP"==i?n.show():n.hide()},$("#section").on("click",'[href*="#modalRole"]',function(t){var e=$("#modalRole"),i=$(this).attr("href"),n=$("#section"),o=n.prev(".loader");return o.show(),n.fadeTo("fast",.5),e.empty(),$.ajax(i).always(function(){o.hide(),n.stop(),n.fadeTo("fast",1)}).done(function(t){e.append(t),e.one("shown",function(){$("#name").focus()}),e.modal({shown:!0})}).fail(function(t){$("body,html").animate({scrollTop:0},"fast");var e=getStatusMsg(t);showError($("#section table"),e)}),!1}),$("#section").on("click","#createRole",function(t){var e=$("#modalRole"),i=$(this).attr("href"),n=$("#section"),o=n.prev(".loader");return o.show(),n.fadeTo("fast",.5),e.empty(),$.ajax(i).always(function(){o.hide(),n.stop(),n.fadeTo("fast",1)}).done(function(t){e.append(t),e.one("shown",function(){$("#name").focus(),$(".chzn-select").chosen({width:""}),$(".chzn-deselect").chosen({allow_single_deselect:!0,width:""})}),e.modal({shown:!0})}).fail(function(t){$("body,html").animate({scrollTop:0},"fast");var e=getStatusMsg(t);showError($("#section table"),e)}),!1}),$("body").on("submit",'form[name="role"]',function(t){var e=$(this),i=$("#modalRole"),n=i.find(".modal-body");return isFormValid(e)&&(resetAlert(n),$.ajax({type:"POST",url:e.attr("action"),data:e.serialize()}).done(function(){i.on("hidden",function(){$(window).hashchange()}),i.modal("hide")}).fail(function(t){var e=getStatusMsg(t);resetAlert(n),showPermanentError(n.children().first(),e)})),!1}),$(function(){var t=new ScanWMIRules;new ScanWMIRuleView({items:t,parent:$("#section")})});var ScanWMIRules=function(){};ScanWMIRules.prototype=new Items;var ScanWMIRuleView=function(t){this.parent=t.parent,this.items=t.items,t.parent.on("click",'#wmi_rulesEmpty [href="#add"]',function(t){return $("#wmi_rules").trigger("addrow"),$("#wmi_rulesEmpty").addClass("hidden"),!1})};$(function(){var t=new Sources;new SourceView({items:t,parent:$("#section")})});var Sources=function(){};Sources.prototype=new Items,Sources.prototype.id="#sources",Sources.prototype.formName="modalSource",Sources.prototype.modalId="#modalSource";var SourceView=function(t){ItemView.call(this,t);var e=t.items,i=e.id,n='form[name="'+e.formName+'"]';t.parent.off("click",i+' [href$="/clone"]'),t.parent.off("click",i+' [href$="/delete"]'),t.parent.on("click","#testSourceBtn",$.proxy(this.testSource,this)),t.parent.on("change",n+' select[name*="\\.conditions\\."][name$=".attribute"]',$.proxy(this.changeCondition,this)),t.parent.on("change",n+' select[name*="\\.actions\\."][name$=".type"]',$.proxy(this.changeAction,this)),t.parent.on("section.loaded",$.proxy(this.loadSource,this)),t.parent.on("dynamic-list.add",'div[id^="accordion\\.group\\.administration_rules\\."]',$.proxy(this.addRule,this)),t.parent.on("dynamic-list.add",'div[id^="accordion\\.group\\.authentication_rules\\."]',$.proxy(this.addRule,this)),t.parent.on("dynamic-list.add",'div[id*="\\.actions\\."]',$.proxy(this.addAction,this)),t.parent.on("dynamic-list.add",'div[id*="\\.conditions\\."]',$.proxy(this.addCondition,this)),t.parent.on("dynamic-list.ordered",i+" #internal-sources tbody",$.proxy(this.sortItems,this))};SourceView.prototype=function(){function t(){}return t.prototype=ItemView.prototype,new t}(),SourceView.prototype.addCondition=function(t){t.stopPropagation();var e=$(t.target);return updateSoureRuleCondition(e.find('select[name*="\\.conditions\\."][name$=".attribute"]'),!0),!1},SourceView.prototype.addAction=function(t){t.stopPropagation();var e=$(t.target);return updateAction(e.find('select[name*="\\.actions\\."][name$=".type"]'),!0),!1},SourceView.prototype.addRule=function(t){$(t.target).find('select[name*="\\.actions\\."][name$=".type"]:not(.disabled)').each(function(){updateAction($(this),!0)})},SourceView.prototype.loadSource=function(t){var e=this.items.formName;$("#action_templates").find("option").removeAttr("id"),$('form[name="'+e+'"] select[name*="\\.conditions\\."][name$=".attribute"]:not(.disabled)').each(function(){updateSoureRuleCondition($(this),!0)}),$('form[name="'+e+'"] select[name*="\\.actions\\."][name$=".type"]:not(.disabled)').each(function(){updateAction($(this),!0)})},SourceView.prototype.changeAction=function(t){updateAction($(t.target),!1)},SourceView.prototype.changeCondition=function(t){updateSoureRuleCondition($(t.target),!1)},SourceView.prototype.testSource=function(t){t.preventDefault();var e=$(t.target),i=e.closest("form"),n=isFormValid(i);resetAlert($("#section")),n&&this.items.post({url:e.attr("href"),data:i.serialize(),always:function(){e.button("reset")},success:function(t,e,n){showSuccess(i,t.status_msg)},errorSibling:i})},SourceView.prototype.sortItems=function(t){var e=$(t.target).closest("form");this.items.post({url:e.attr("action"),data:e.serialize(),success:function(t,i,n){showSuccess(e,t.status_msg)},errorSibling:e})},SourceView.prototype.updateItem=function(t){t.preventDefault();var e=$(t.target),i=e.find(".btn-primary");isFormValid(e)&&(i.button("loading"),resetAlert($("#section")),this.items.post({url:e.attr("action"),data:e.serialize(),always:function(){$("body,html").animate({scrollTop:0},"fast"),i.button("reset")},success:function(t,i,n){n.getResponseHeader("Location")?location.hash=n.getResponseHeader("Location"):showSuccess(e,t.status_msg)},errorSibling:e}))},SourceView.prototype.constructor=SourceView,$(function(){var t=new Switches;new SwitchView({switches:t,parent:$("#section")})});var Switches=function(){};Switches.prototype.get=function(t){$.ajax({url:t.url}).always(t.always).done(t.success).fail(function(e){var i=getStatusMsg(e);showPermanentError(t.errorSibling,i)})},Switches.prototype.post=function(t){$.ajax({url:t.url,type:"POST",data:t.data}).always(t.always).done(t.success).fail(function(e){var i=getStatusMsg(e);showPermanentError(t.errorSibling,i)})};var SwitchView=function(t){var e=this;this.parent=t.parent,this.switches=t.switches,this.disableToggle=!1;var i=$.proxy(this.readSwitch,this);t.parent.on("click",'#switches [href$="/read"], #switches [href$="/clone"], .createSwitch',i);var n=$.proxy(this.importSwitch,this);t.parent.on("submit",'form[name="modalSwitchImport"]',n);var o=$.proxy(this.updateSwitch,this);t.parent.on("submit",'form[name="modalSwitch"]',o);var r=$.proxy(this.deleteConfirm,this);t.parent.on("click",'#switches [href$="/delete"]',r);var a=$.proxy(this.removeGroup,this);t.parent.on("click",'form[name="modalSwitch"] [href$="/remove_group"]',a);var s=$.proxy(this.addToGroup,this);t.parent.on("click",'form[name="modalSwitch"] #addNewMember',s),t.parent.on("change",'form[name="modalSwitch"] input[name="uplink_dynamic"]',this.changeDynamicUplinks),t.parent.on("change",'form[name="modalSwitch"] input[type="checkbox"][name*="Map"]',this.changeRoleMapping),t.parent.on("click",'#inlineTriggerEmpty [href="#add"]',this.addInlineTrigger),t.parent.on("show","#modalSwitch",function(i){$("#inlineTrigger tr:not(.hidden) select").each(function(){e.updateInlineTrigger($(this))}),t.parent.find('#newMember[data-provide="typeahead"]').typeahead({source:$.proxy(e.searchSwitch,e),minLength:2,items:11,matcher:function(t){return!0}})}),t.parent.on("admin.added","#inlineTrigger tr",function(t){var i=$(this).find("select").first();e.updateInlineTrigger(i)}),t.parent.on("change","#inlineTrigger select",function(t){e.updateInlineTrigger($(this))});var c=$.proxy(this.pagination,this);t.parent.on("click",'#switches [href*="/list"]',c),t.parent.on("submit","#switches #search",$.proxy(this.submitSearch,this)),t.parent.on("reset","#switches #search",$.proxy(this.resetSearch,this)),t.parent.on("click",'#switches [href*="/switch/search"]',$.proxy(this.searchPagination,this)),t.parent.on("click","#invalidate_cache",$.proxy(this.invalidateCache,this))};SwitchView.prototype.readSwitch=function(t){t.preventDefault();var e=this,i=$("#modalSwitch"),n=$("#section"),o=n.prev(".loader");o.show(),n.fadeTo("fast",.5),i.empty(),$(".chzn-drop").remove(),this.switches.get({url:$(t.target).attr("href"),always:function(){o.hide(),n.stop(),n.fadeTo("fast",1)},success:function(t){i.append(t),i.find(".chzn-select").chosen({width:""}),i.find(".chzn-deselect").chosen({allow_single_deselect:!0,width:""}),i.one("shown",function(){var t;i.find(":input:visible").first().focus(),t=$('form[name="modalSwitch"] input[name="uplink_dynamic"]'),e.changeDynamicUplinks.call(t),(t=$('form[name="modalSwitch"] input[type="checkbox"][name*="Map"]')).each(function(t){e.changeRoleMapping.call(this)})}),i.modal({shown:!0})},errorSibling:n.find("h2").first()})},SwitchView.prototype.changeRoleMapping=function(t){var e=$(this),i=/(.+)Map/.exec(e.attr("name"))[1],n=$.merge(e.closest("form").find('input[type="text"][name*="'+i+'"]'),e.closest("form").find('textarea[name*="'+i+'"]'));e.is(":checked")?n.removeAttr("disabled"):n.attr("disabled",1)},SwitchView.prototype.changeDynamicUplinks=function(t){var e=$(this),i=e.closest("form").find('input[name="uplink"]').first();e.is(":checked")?i.attr("disabled",1):i.removeAttr("disabled")},SwitchView.prototype.addInlineTrigger=function(t){var e=$("#inlineTrigger").children("tbody").children(".hidden").first();if(e){$("#inlineTriggerEmpty").addClass("hidden");var i=e.clone();i.removeClass("hidden"),i.insertBefore(e),i.trigger("admin.added")}return!1},SwitchView.prototype.updateInlineTrigger=function(t){var e=t.find(":selected").val(),i=t.next();if(e!=i.attr("data-trigger")){i.attr("disabled",1);var n=$("#"+e+"_trigger").clone();n.attr("id",i.attr("id")),n.attr("name",i.attr("name")),n.insertBefore(i),i.attr("data-trigger")||n.val(i.val()),i.remove(),n.attr("data-trigger",e)}},SwitchView.prototype.updateSwitch=function(t){t.preventDefault();var e=this,i=$(t.target),n=i.find(".btn-primary"),o=i.closest(".modal");if(isFormValid(i)){var r=o.find(".modal-body").first();resetAlert(r),n.button("loading"),i.find("tr.hidden :input").attr("disabled","disabled"),this.switches.post({url:i.attr("action"),data:i.serialize(),always:function(){i.find("tr.hidden :input").removeAttr("disabled"),n.button("reset")},success:function(t){o.modal("toggle"),showSuccess(e.parent.find(".table.items").first(),t.status_msg),e.refreshTable()},errorSibling:r.children().first()})}},SwitchView.prototype.importSwitch=function(t){var e=$(t.target),i=$("#iframe_form"),n=e.find(".btn-primary"),o=e.closest(".modal");n.button("loading"),i.one("load",function(t){n.button("reset");var e=$(this).contents().find("body").find("textarea").val();o.modal("hide"),showPermanentSuccess($("#switches"),e)})},SwitchView.prototype.addToGroup=function(t){t.preventDefault();var e=this,i=$(t.target),n=$("#newMember").val();this.switches.get({url:"/config/switch/"+n+"/add_to_group/"+i.attr("data-group"),success:function(t){e.readSwitch({preventDefault:function(){},target:{href:"/config/switchgroup/"+i.attr("data-group")+"/read?tab=switchGroupMembers"}}),showSuccess($("#modalSwitch .modal-body").children().first(),t.status_msg)},errorSibling:$("#modalSwitch .modal-body").children().first()})},SwitchView.prototype.removeGroup=function(t){t.preventDefault();var e=$(t.target);this.switches.get({url:e.attr("href"),success:function(t){e.closest(".switchGroupMember").remove(),0===$(".switchGroupMember").size()&&$("#switchMembersEmpty").closest("tr").removeClass("hidden"),showSuccess($("#modalSwitch .modal-body").children().first(),t.status_msg)},errorSibling:$("#modalSwitch .modal-body").children().first()})},SwitchView.prototype.list=function(){this.switches.get({url:"/config/switch/list",success:function(t){$("#switches").html(t)},errorSibling:$("#switches")})},SwitchView.prototype.refreshPage=function(){var t=this,e=$(".pagination").first(),i=e.attr("data-from-form")||"#search",n=$(i),o=e.find("li.disabled a[href]").first();0===n.length&&(n=$("#search"));var r=$("#columns"),a=o.attr("href"),s=$("#section"),c=$("#section").find("h2").first(),l=s.prev(".loader");return l.show(),s.fadeTo("fast",.5),s.fadeTo("fast",.5,function(){t.switches.post({url:a,data:n.serialize()+"&"+r.serialize(),always:function(){l.hide(),s.fadeTo("fast",1)},success:function(t){s.html(t)},errorSibling:c})}),!1},SwitchView.prototype.refreshTable=function(){var t=this,e=$(".pagination").first(),i=e.attr("data-from-form")||"#search",n=$(i),o=e.find("li.disabled a[href]").first();0===n.length&&(n=$("#search"));var r=$("#columns"),a=o.attr("href"),s=$("#section"),c=$("#section").find("h2").first(),l=$("#switches"),d=s.prev(".loader");return d.show(),s.fadeTo("fast",.5,function(){t.switches.post({url:a,data:n.serialize()+"&"+r.serialize(),always:function(){d.hide(),s.fadeTo("fast",1)},success:function(t){l.html(t)},errorSibling:c})}),!1},SwitchView.prototype.pagination=function(t){t.preventDefault();var e=$(t.target).attr("href"),i=$("#section"),n=i.prev(".loader");return n.show(),i.fadeTo("fast",.5),this.switches.get({url:e,always:function(){n.hide(),i.stop(),i.fadeTo("fast",1)},success:function(t){$("#switches").html(t)},errorSibling:$("#switches")}),!1},SwitchView.prototype.searchPagination=function(t){t.preventDefault();var e=$(t.currentTarget),i=$("#search"),n=e.attr("href");return this.refreshListFromForm(n,i),!1},SwitchView.prototype.refreshListFromForm=function(t,e){var i=this,n=$("#section");$("body,html").animate({scrollTop:0},"fast");var o=$("#section").find("h2").first(),r=n.prev(".loader");return r.show(),n.fadeTo("fast",.5,function(){i.switches.post({url:t,data:e.serialize(),always:function(){r.hide(),n.fadeTo("fast",1)},success:function(t){$("#switches").html(t)},errorSibling:o})}),!1},SwitchView.prototype.submitSearch=function(t){t.preventDefault();var e=$(t.currentTarget),i=e.attr("action");return this.refreshListFromForm(i,e),!1},SwitchView.prototype.resetSearch=function(t){var e=this,i=$("#section");$("body,html").animate({scrollTop:0},"fast");var n=$("#section").find("h2").first(),o=i.prev(".loader");return o.show(),i.fadeTo("fast",.5,function(){e.switches.post({url:"/config/switch/list",always:function(){o.hide(),i.fadeTo("fast",1)},success:function(t){$("#switches").html(t)},errorSibling:n})}),!0},SwitchView.prototype.deleteConfirm=function(t){t.preventDefault();var e=this,i=$(t.target),n=i.closest("tr"),o=i.attr("href"),r=$("#deleteSwitch"),a=r.find("a.btn-primary").first();return a.off("click"),a.click(function(){return e.switches.get({url:o,success:function(t){showSuccess($("#switches"),t.status_msg),n.fadeOut("slow",function(){$(this).remove()})},always:function(){r.modal("hide")},errorSibling:$("#switches")}),!1}),r.modal({show:!0}),!1},SwitchView.prototype.invalidateCache=function(t){t.preventDefault();var e=$("#modalSwitch").find(".modal-body"),i=$(t.target).attr("href");this.switches.get({url:i,success:function(t){showSuccess(e.children().first(),t.status_msg)},errorSibling:e.children().first()})},SwitchView.prototype.searchSwitch=function(t,e){this.switches.post({url:"/config/switch/search",data:{json:1,all_or_any:"any","searches.0.name":"id","searches.0.op":"like","searches.0.value":t},success:function(t){var i=$.map(t.items,function(t){return t.id}),n=$("#modalSwitch #newMember").closest(".control-group");0===i.length?n.addClass("error"):n.removeClass("error"),e(i)}})},$(function(){$("#section").on("change","#modalItem.syslogforwarded #all_logs",function(t){var e=t.currentTarget,i=$("#logs").closest("div.control-group");e.checked?(console.log("checked"),i.addClass("hidden")):i.removeClass("hidden")})}),$(function(){function t(t){var e=$("#modalViolation");e.empty(),e.append(t),e.find(".switch").bootstrapSwitch(),e.find(".chzn-select").chosen({inherit_select_classes:!0,width:""}),e.find(".chzn-deselect").chosen({allow_single_deselect:!0,width:""}),e.one("shown",function(){var t=e.find(".event_triggers").first()[0];violationsView.event_triggers=JSON.parse(t.textContent||t.innerHTML),$("#actions").trigger("change")}),$(".trigger option").each(function(t){var e=$(this),i=e.val().split("::");if("accounting"==i[0].toLowerCase()){var n=violationsView.prettify_accounting(i[0],i[1]);e.html(n),e.closest("select").trigger("chosen:updated")}}),e.modal("show")}$("#section").on("click",'[href*="#modalViolation"]',function(e){var i=$(this).attr("href"),n=$("#section"),o=n.prev(".loader");return o.show(),n.fadeTo("fast",.5),$.ajax(i).always(function(){o.hide(),n.stop(),n.fadeTo("fast",1)}).done(function(e){t(e)}).fail(function(t){var e=getStatusMsg(t);$("body,html").animate({scrollTop:0},"fast"),showError($("#section h2"),e)}),!1}),$("#section").on("click","#createViolation",function(e){var i=$(this).attr("href"),n=$("#section"),o=n.prev(".loader");return o.show(),n.fadeTo("fast",.5),$.ajax(i).always(function(){o.hide(),n.stop(),n.fadeTo("fast",1)}).done(function(e){t(e)}).fail(function(t){$("body,html").animate({scrollTop:0},"fast");var e=getStatusMsg(t);showError($("#section h2"),e)}),!1}),$("#section").on("change","#viewTriggers select",function(){violationsView.recompute_triggers()}),$("#section").on("click",'[href*="/delete"]',function(t){if(t.preventDefault(),$(this).hasClass("disabled"))return!1;var e=$(this),i=e.attr("href"),n=e.closest("tr"),o=n.find("td"),r=$(o[1]).text();r||(r=$(o[0]).text());var a=$("#deleteViolation"),s=a.find("a.btn-primary").first();return a.find("h3 span").html(r),a.modal("show"),s.off("click"),s.click(function(t){t.preventDefault(),s.button("loading"),$.ajax(i).always(function(){a.modal("hide"),s.button("reset")}).done(function(t){n.remove();var e=$("#section table");0===e.find("tbody tr").length&&(e.remove(),$("#noViolation").removeClass("hidden"))}).fail(function(t){var e=getStatusMsg(t);showError($("#section h2"),e),s.button("reset")})}),!1}),$("body").on("change","#actions",function(t){var e=$(this).val(),i=$("#vclose").closest(".control-group");$.inArray("close",e)<0?i.fadeOut("fast"):i.fadeIn("fast");var n=$("#target_category").closest(".control-group");$.inArray("role",e)<0?n.fadeOut("fast"):n.fadeIn("fast");var o=$("#external_command").closest(".control-group");$.inArray("external",e)<0?o.fadeOut("fast"):o.fadeIn("fast"),o=$("#user_mail_message").closest(".control-group"),$.inArray("email_user",e)<0?o.fadeOut("fast"):o.fadeIn("fast"),o=$("#access_duration").closest(".control-group"),$.inArray("autoreg",e)<0?o.fadeOut("fast"):o.fadeIn("fast")}),$("body").on("switch-change","#violations .switch",function(t,e){t.preventDefault();var i=$(t.target);if(!i.attr("processing")){i.attr("processing","processing");var n=i.attr("data-href"),o=e.value?"yes":"no";n=n.replace(/enabled$/,o),$.ajax({type:"POST",url:n,data:""}).always(function(){i.attr("processing",null)}).done(function(t){showSuccess($("#section h2"),t.status_msg)}).fail(function(t){var e=getStatusMsg(t);showError($("#section h2"),e)})}}),$("body").on("submit",'form[name="violation"]',function(t){var e=$(this),i=e.find(".btn-primary"),n=$("#modalViolation"),o=n.find(".modal-body");return isFormValid(e)&&(resetAlert(o),i.button("loading"),$.ajax({type:"POST",url:e.attr("action"),data:e.serialize()}).always(function(){i.button("reset")}).done(function(){n.on("hidden",function(){$(window).hashchange()}),n.modal("hide")}).fail(function(t){var e=getStatusMsg(t);resetAlert(o),showPermanentError(o.children().first(),e)})),!1}),$.fn.typeahead.Constructor.prototype.select=function(){var t=this.$menu.find(".active").data("item");return this.$element.val(this.updater(t)).change(),this.hide()},$.fn.typeahead.Constructor.prototype.render=function(t){var e=this;return(t=$(t).map(function(t,i){return(t=$(e.options.item).data("item",i)).find("a").html(e.highlighter(i)),t[0]})).first().addClass("active"),this.$menu.html(t),this},$("body").on("click",'[href="#deleteTrigger"]',function(t){t.preventDefault();return $(t.target).closest(".control-group").remove(),$("#viewTriggers").find("select").length||$("#noTrigger").removeClass("hide"),violationsView.recompute_triggers(),!1}),$("body").on("click",'[href="#addTrigger"]',function(t){t.preventDefault();$(t.target);return $("#viewTriggers").slideUp(function(){$("#editedTrigger").html(ViolationsView.add_combined_trigger_form()),violationsView.previous_trigger_options=$("#editedTrigger .triggerButtons").html(),$("#editedTrigger .triggerButtons").html('<a href="#backEditTrigger" class="pull-left btn btn-default"><i class="icon  icon-chevron-left"></i></a>'),$("#editedTrigger .chzn-select").chosen({inherit_select_classes:!0,width:""}),$("#editTrigger").slideDown()}),!1}),$("body").on("click",'[href="#editTrigger"]',function(t){t.preventDefault();var e=$(t.target);return $("#viewTriggers").slideUp(function(){e.closest(".control-group").appendTo("#editedTrigger"),violationsView.previous_trigger_options=$("#editedTrigger .triggerButtons").html(),$("#editedTrigger .triggerButtons").html('<a href="#backEditTrigger" class="pull-left btn btn-default"><i class="icon  icon-chevron-left"></i></a>'),$("#editTrigger").slideDown()}),!1}),$("body").on("click",'[href="#backEditTrigger"]',function(t){t.preventDefault();var e=$(t.target);return $("#editTrigger").slideUp(function(){var t=e.closest(".control-group");t.find("select option:selected").length&&($("#noTrigger").addClass("hide"),t.find(".triggerButtons").html(violationsView.previous_trigger_options),t.appendTo("#viewTriggers")),$("#editedTrigger").html(""),$("#viewTriggers").slideDown()}),violationsView.recompute_triggers(),!1}),$("body").on("click","#add_trigger_part",function(t){t.preventDefault();var e=$("#tid").val(),i=$("#trigger_type").find(":selected"),n=i.val();if(""===n)return!1;var o=n+"::"+e,r=i.text()+" : "+e;violationsView.append_trigger(o,r)}),$("body").on("click",".add_accounting_trigger",function(t){t.preventDefault();var e=$("#accounting_widget_direction").find(":selected").val()+$("#accounting_widget_amount").val()+$("#accounting_widget_unit").find(":selected").val()+$("#accounting_widget_window").find(":selected").val(),i="accounting::"+e;violationsView.append_trigger(i,violationsView.prettify_accounting("accounting",e))}),$("body").on("click",".add_trigger_part",function(t){t.preventDefault(),t.stopPropagation();var e=$(this).closest(".controls").find("select").find(":selected"),i=e.val(),n=$("#trigger_type").find(":selected"),o=n.val()+"::"+i,r=n.html()+" : "+e.html();violationsView.append_trigger(o,r)}),$("body").on("click","#violationSubmit",function(t){return t.preventDefault(),$("#editTrigger .control-group select").not("#trigger_type").not(".trigger_widget_select").appendTo("#viewTriggers"),violationsView.recompute_triggers(),$('[name="violation"]').submit(),!1}),$("body").on("change","#trigger_type",function(){var t=$("#trigger_type option:selected").val();$(".trigger_widget").slideUp(),$("."+t+"_triggers").slideDown()}),$("body").on("click",".trigger_widget a",function(){$("#modalViolation").modal("hide"),window.location=$(this).attr("href")})});var ViolationsView=function(){};ViolationsView.prototype.recompute_triggers=function(){var t={};$("#viewTriggers select").find(":selected").each(function(){var e=$(this),i=e.closest("select");i.uniqueId(),t[i.attr("id")]||(t[i.attr("id")]=[]),t[i.attr("id")].push(e.val())});var e=[];for(var i in t){var n;n=t[i].length>1?"("+(n=t[i].join("&"))+")":t[i][0],e.push(n)}$("#trigger").val(e.join())},ViolationsView.add_combined_trigger_form=function(){return['<div class="control-group">','  <span class="triggerButtons">','    <a class="btn pull-left" href="#editTrigger">','      <i class="icon icon-pencil"></i>',"    </a>",'    <a class="btn btn-danger pull-left" href="#deleteTrigger">','      <i class="icon icon-remove"></i>',"    </a>","  </span>",'  <select multiple="multiple" class="chzn-select input-xxlarge">',"  </select>","</div>"].join(" ")},ViolationsView.prototype.prettify_accounting=function(t,e){t.toLowerCase();var i,n=e.toLowerCase();if("bandwidthexpired"==n)i="Bandwidth expired";else if("timeexpired"==n)i="Time expired";else{var o=/^(TOT|IN|OUT)([0-9]+)(B|KB|MB|GB|TB)([DWMY])$/.exec(e),r=o[1],a=o[2],s=o[3],c=o[4];i="","TOT"==r?i+="Total traffic over "+a+" "+s+" ":"IN"==r?i+="Inbound traffic over "+a+" "+s+" ":"OUT"==r&&(i+="Outbound traffic over "+a+" "+s+" "),"D"==c?i+="per day":"W"==c?i+="per week":"M"==c?i+="per month":"Y"==c&&(i+="per year")}return i},ViolationsView.prototype.append_trigger=function(t,e){var i=this;e||(e=t);var n=!1,o=$("#editedTrigger select").first();if(i.event_triggers.indexOf(t.split("::")[0].toLowerCase())>-1&&o.find("option:selected").each(function(){var t=$(this).val().split("::");i.event_triggers.indexOf(t[0].toLowerCase())>-1&&(n=$(this).html())}),n)showError($("#viewTriggers"),"There is already an evenemential trigger defined ("+n+"). Only one is allowed per combined trigger.");else{var r=!0;o.find("option").each(function(){if($(this).val()>t)return $('<option value="'+t+'" selected="selected">'+e+"</option>").insertBefore(this),r=!1,!1}),r&&o.append('<option value="'+t+'" selected="selected">'+e+"</option>"),o.trigger("chosen:updated")}},ViolationsView.prototype.add_fingerbank_trigger=function(t,e,i){violationsView.append_trigger(t.model_stripped()+"::"+e,t.model_stripped()+" "+i)};var violationsView=new ViolationsView;
//# sourceMappingURL=configuration.js.map