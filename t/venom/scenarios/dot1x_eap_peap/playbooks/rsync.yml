---
- hosts: pfservers, service_venom, nodes
  name: Rsync Git repository t/venom with /usr/local/pf/t/venom (localdev only)
  become: True

  tasks:
    - name: Synchronize Git repository t/venom with /usr/local/pf/t/venom
      ansible.posix.synchronize:
        # src is provided through test-wrapper.sh
        # as $PWD/venom (no leading slash)
        src: "{{ lookup('env', 'VENOM_ROOT_DIR') }}"
        dest: '/usr/local/pf/t/'
        archive: yes
        delete: yes
        # exclude files dynamically generated by Ansible
        rsync_opts:
          - "--exclude=vars/local.yml"

    - name: Synchronize Git repository t/mock_servers with /usr/local/pf/t/mock_servers
      ansible.posix.synchronize:
        # src is provided through test-wrapper.sh
        # as $PWD/venom (no leading slash)
        src: "{{ lookup('env', 'VENOM_ROOT_DIR') }}/../mock_servers"
        dest: '/usr/local/pf/t/'
        archive: yes
        delete: yes
        # exclude files dynamically generated by Ansible
        rsync_opts:
          - "--exclude=vars/local.yml"

